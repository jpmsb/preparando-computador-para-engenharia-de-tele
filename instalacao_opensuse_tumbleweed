#!/bin/bash

export LC_ALL=C.UTF-8
export ZYPP_MEDIANETWORK=1
export ZYPP_PCK_PRELOAD=1
export ZYPP_CURL2=1
export ZYPP_LOCK_TIMEOUT='-1'

### Funções auxiliares ###
desmontar_tudo(){
    local destino=$1

    ### Desmontando diretórios ###
    umount $destino/sys/firmware/efi/efivars
    umount $destino/boot/efi
    umount $destino/dev
    umount $destino/proc
    umount $destino/sys
    umount $destino
}

tentar(){
    local comando="$1"
    local tentativas=$2
    local tentativa_atual=0
    local espera=5

    until [ $tentativa_atual -ge $tentativas ]; do
        eval "$comando" && break

        echo -e "\nOcorreu um erro, tentando novamente em $espera segundos...\n"
        local tentativa_atual=$((tentativa_atual + 1))
        sleep $espera

        if [ $tentativa_atual -eq $tentativas ]; then
            echo -e "\nApós $tentativas tentativas, o comando de instalação finalizou com erro."
            echo "Verifique se você está conectado a Internet e se há espaço suficiente na partição onde o sistema será instalado."

            echo ""
            while [[ "$tentar_novamente" != [sSnN] ]]; do
                read -p "Você deseja tentar repetir o passo que falhou? [S/N] " tentar_novamente
            done

            if [[ "$tentar_novamente" == [sS] ]]; then
                local tentativa_atual=0
                unset tentar_novamente
            else
                echo ""
                echo "╔══════════════════════════════════════════════════════════════════════════════════════════╗"
                echo "║                                                                                          ║" 
                echo "║ Você pode tentar executar esse script novamente para reiniciar o processo de instalação. ║"
                echo "║                                                                                          ║" 
                echo "╚══════════════════════════════════════════════════════════════════════════════════════════╝"
                echo ""
                echo "Atenção: é preciso limpar a partição \"$particao_raiz\" afim de evitar conflitos."
                echo ""
                exit 1
            fi
        fi
    done
}

tipo_particao(){
    local particao="$1"
    echo $(/usr/bin/lsblk -f -no FSTYPE "$particao")
}

tamanho_particao(){
    local particao="$1"
    echo "$(/usr/bin/lsblk -b $particao --output SIZE | grep -oP '\d+' | awk '{print $1}')"
}

converte_para_bytes() {
    local entrada="$1"
    local numero=$(echo "$entrada" | sed 's/[KMG]\?$//')
    local unidade=$(echo "$entrada" | sed 's/[0-9]*\([KMG]\?\)$/\1/')

    case "$unidade" in
        "K") local fator=1024 ;;
        "M") local fator=$((1024 * 1024)) ;;
        "G") local fator=$((1024 * 1024 * 1024)) ;;
        "T") local fator=$((1024 * 1024 * 1024 * 1024)) ;;
        *)   local fator=1 ;;
    esac

    local valor_em_bytes=$((numero * fator))
    echo "$valor_em_bytes"
}

valida_particao(){
    local particao_informada="/dev/$1"
    local tipo_particao_desejado="$2"
    local capacidade_minima="$3"
    local capacidade_minima_em_bytes="$(converte_para_bytes $3)"

    if [[ -b "$particao_informada" ]]; then
       local particao_identificada="$(tipo_particao $particao_informada)"
 
       if [[ "$tipo_particao_desejado" == *"$particao_identificada"* ]]; then
           local capacidade_particao="$(tamanho_particao $particao_informada)"
  
           if [[ "$capacidade_particao" -lt "$capacidade_minima_em_bytes" ]]; then
               printf "$vermelho"
               printf "\nA partição informada possui capacidade menor do que ${capacidade_minima}B.\n"
               printf "Por favor, informe uma partição com pelo menos $magenta${capacidade_minima}B$normal$vermelho de capacidade.\n"
               printf "$normal"
           else
               echo "$particao_informada"
           fi
       else
           printf "$vermelho"
           printf "\nA partição informada não está formatada como ${tipo_particao_desejado// / ou }.\n"
           printf "Por favor, informe uma partição válida ou formate-a para que fique de acordo.\n"
           printf "$normal"
       fi
    elif [ ! -z "$particao_informada" ]; then
        printf "$vermelho"
        printf "\nA partição informada não existe. Por favor, informe uma partição válida.\n"
        printf "$normal"
    fi
}

valida_dispositivo(){
    local dispositivo_informado="/dev/$1"

    if [[ -b "$dispositivo_informado" ]]; then
        local procura=$(ls -1 $dispositivo_informado* 2>/dev/null | wc -l)
        
        if [ $procura -gt 1 ]; then
            echo "$dispositivo_informado"
        else
            printf "$vermelho"
	    echo "\nO dispositivo informado é uma partição. Por favor, informe o dispositivo que contém a partição.\n"
            printf "$normal"
	fi
    else
        printf "$vermelho"
        printf "\nO dispositivo informado não existe. Por favor, informe um dispositivo válido.\n"
        printf "$normal"
    fi
}

checa_tipo_tabela_de_particao(){
    local dispositivo="$1"
    local tipo_tabela=$(fdisk -l $dispositivo 2>/dev/null | grep -oP 'Disklabel type: \K\w+')

    if [[ "$tipo_tabela" == "gpt" ]]; then
        echo "GPT"
    elif [[ "$tipo_tabela" == "dos" ]]; then
        echo "DOS"
    else
        echo "Desconhecido"
    fi
}

checa_particao_bios(){
    local dispositivo="$1"
    parted -s $dispositivo print | grep 'bios_grub'
}

mostra_preenchido(){
    local valor1="$1"
    local valor2="$2"
    local texto="$3"

    if [ ! -z "$valor1" ] && [ ! -z "$valor2" ]; then
        printf "$texto"
        printf "$verde"
        printf "$valor1"
        printf "$normal\n"
    fi
}

valida_pacotes(){
    local pacotes="$1"
    local arquivo_log_zypper="$2"
    local argumentos_extra="$3"
    local arquivo_de_resultado="$4"
    unset pacotes_validados

    local data_inicio=$(date +'%Y-%m-%d %H:%M:00')
    zypper -n --ignore-unknown $argumentos_extra install --dry-run -y $pacotes > /dev/null 2>&1
    local data_fim=$(date +'%Y-%m-%d %H:%M:59')

    # Verificando pacotes que não existem no repositório
    local pacotes_inexistentes=$(cat "$arquivo_log_zypper" | awk -v start="$data_inicio" -v end="$data_fim" '$0 >= start && $0 <= end' | grep -oE '.*\[zypper:req\].*not found$' | cut -d ' ' -f 7 | sort | uniq | sed 's/-[0-9].*//' | tr '\n' ' ')

    # Verificando pacotes que possuam algum conflito de dependência
    local pacotes_conflitantes=$(cat "$arquivo_log_zypper" | awk -v start="$data_inicio" -v end="$data_fim" '$0 >= start && $0 <= end' | grep -oE '.*do not install.*' | grep -oE '\S+$' | sort | uniq | sed 's/-[0-9].*//' | tr '\n' ' ')

    if [ ! -z "$arquivo_de_resultado" ]; then
        rm -f "$arquivo_de_resultado"
        if [ ! -z "$pacotes_inexistentes" ]; then
            echo "Pacotes inexistentes:" > "$arquivo_de_resultado"
            echo "$pacotes_inexistentes" | tr ' ' '\n' >> "$arquivo_de_resultado"
            echo "" >> "$arquivo_de_resultado"
        fi

        if [ ! -z "$pacotes_conflitantes" ]; then
            echo "Pacotes conflitantes:" >> "$arquivo_de_resultado"
            echo "$pacotes_conflitantes" | tr ' ' '\n' >> "$arquivo_de_resultado"
        fi
    fi

    # Filtrando pacotes
    for pacote in ${pacotes}; do
        if ! echo "${pacotes_inexistentes}" | grep -wq "${pacote}" && ! echo "${pacotes_conflitantes}" | grep -wq "${pacote}"; then
            local pacotes_validados="$pacotes_validados $pacote"
        fi
    done

    echo "$pacotes_validados"
}

barra_rotativa() {
    local barra_inicial="$1"

    if [ -z "$barra_inicial" ]; then
        echo "|"
    elif [ "$barra_inicial" == "|" ]; then
        echo "/"
    elif [ "$barra_inicial" == "/" ]; then
        echo "-"
    elif [ "$barra_inicial" == "-" ]; then
        echo "\\"
    else
        echo "|"
    fi
}

mostra_espera(){
    local texto="$1"
    local arquivo_sinalizador="$2"
    local mensagem="$texto"

    while [ -f "$arquivo_sinalizador" ]; do
        if [ -z "$texto" ]; then
            mensagem="$(cat "$arquivo_sinalizador")"
        fi
        local barra_atual="$(barra_rotativa "$barra_atual")"
        echo -ne "$mensagem [$barra_atual]\r"
        sleep 0.1
    done

    if [ ! -z "$barra_atual" ]; then echo -ne "\033[2K\r"; fi
}

valida_pacotes_visualizado(){
    local texto_titulo="$1"
    local pacotes="$2"
    local arquivo_log_zypper="$3"
    local argumentos_extra="$4"
    local variavel_exportada="$5"
    local arquivo_de_resultado="$6"
    local arquivo_sinalizador="$(mktemp)"

    mostra_espera "$texto_titulo" "$arquivo_sinalizador" &
    local espera_pid=$!
    export $variavel_exportada="$(valida_pacotes "$pacotes" "$arquivo_log_zypper" "$argumentos_extra" "$arquivo_de_resultado")"
    rm "$arquivo_sinalizador"
    wait $espera_pid
}

arquivo_bootloader(){
    if [ -d /sys/firmware/efi ]; then
        printf '%s\n'                                                               \
            ""                                                                      \
            "## Path: System/Bootloader"                                            \
            "## Description: Bootloader configuration"                              \
            "## Type: list(grub,grub2,grub2-efi,none)"                              \
            "## Default: grub2"                                                     \
            "#"                                                                     \
            "# Type of bootloader in use."                                          \
            "# For making the change effect run bootloader configuration tool"      \
            "# and configure newly selected bootloader"                             \
            "#"                                                                     \
            "#"                                                                     \
            "LOADER_TYPE=\"grub2-efi\""                                             \
            ""                                                                      \
            "## Path: System/Bootloader"                                            \
            "## Description: Bootloader configuration"                              \
            "## Type: yesno"                                                        \
            "## Default: \"no\""                                                    \
            "#"                                                                     \
            "# Enable Secure Boot support"                                          \
            "# Only available on UEFI systems and IBM z15+."                        \
            "#"                                                                     \
            "#"                                                                     \
            "SECURE_BOOT=\"yes\""                                                   \
            ""                                                                      \
            "## Path: System/Bootloader"                                            \
            "## Description: Bootloader configuration"                              \
            "## Type: yesno"                                                        \
            "## Default: \"no\""                                                    \
            "#"                                                                     \
            "# Enable Trusted Boot support"                                         \
            "# Only available on hardware with a Trusted Platform Module."          \
            "#"                                                                     \
            "TRUSTED_BOOT=\"yes\""                                                  \
            ""                                                                      \
            "## Path: System/Bootloader"                                            \
            "## Description: Bootloader configuration"                              \
            "## Type: yesno"                                                        \
            "## Default: \"yes\""                                                   \
            "#"                                                                     \
            "# Update nvram boot settings (UEFI, OF)"                               \
            "# Unset to preserve specific settings or workaround firmware issues."  \
            "#"                                                                     \
            "UPDATE_NVRAM=\"yes\""
    else
        printf '%s\n'                                                               \
            ""                                                                      \
            "## Path: System/Bootloader"                                            \
            "## Description: Bootloader configuration"                              \
            "## Type: list(grub,grub2,grub2-efi,systemd-boot,none)"                 \
            "## Default: grub2"                                                     \
            "#"                                                                     \
            "# Type of bootloader in use."                                          \
            "# For making the change effect run bootloader configuration tool."     \
            "# and configure newly selected bootloader."                            \
            "#"                                                                     \
            "#"                                                                     \
            "LOADER_TYPE=\"grub2\""                                                 \
            ""                                                                      \
            "## Path: System/Bootloader"                                            \
            "## Description: Bootloader configuration"                              \
            "## Type: yesno"                                                        \
            "## Default: \"no\""                                                    \
            "#"                                                                     \
            "# Enable Secure Boot support"                                          \
            "# Only available on UEFI systems and IBM z15+."                        \
            "#"                                                                     \
            "#"                                                                     \
            "SECURE_BOOT=\"yes\""                                                   \
            ""                                                                      \
            "## Path: System/Bootloader"                                            \
            "## Description: Bootloader configuration"                              \
            "## Type: yesno"                                                        \
            "## Default: \"no\""                                                    \
            "#"                                                                     \
            "# Enable Trusted Boot support"                                         \
            "# Only available on hardware with a Trusted Platform Module."          \
            "#"                                                                     \
            "TRUSTED_BOOT=\"no\""                                                   \
            ""                                                                      \
            "## Path: System/Bootloader"                                            \
            "## Description: Bootloader configuration"                              \
            "## Type: yesno"                                                        \
            "## Default: \"yes\""                                                   \
            "#"                                                                     \
            "# Update nvram boot settings (UEFI, OF)"                               \
            "# Unset to preserve specific settings or workaround firmware issues."  \
            "#"                                                                     \
            "UPDATE_NVRAM=\"yes\""
    fi
}

ajustar_tema_icones_tela(){
    local diretorio_base="$1"

    #### Ajuste no ícone de rede ####
    sed -i '/<rect style="fill:currentColor;" class="ColorScheme-Text" x="5" y="6" width="2" height="3" rx="0" ry="0"\/>/d; /<rect style="fill:currentColor;" class="ColorScheme-Text" x="9" y="6" width="2" height="3" rx="0" ry="0"\/>/d' $diretorio_base/Tela-dark/16/devices/network-wired-activated.svg

    #### Alteração dos ícones de energia para versão com melhor visualização ####
    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 0v1h-2c-0.554 0-1 0.446-1 1v12c0 0.554 0.446 1 1 1h8c0.554 0 1-0.446 1-1v-12c0-0.554-0.446-1-1-1h-2v-1h-4zm2 4v3h3l-3 5v-3h-3l3-5z" fill="#555555"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/ac-adapter-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/ac-adapter-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 0v1h-2c-0.554 0-1 0.446-1 1v12c0 0.554 0.446 1 1 1h8c0.554 0 1-0.446 1-1v-12c0-0.554-0.446-1-1-1h-2v-1h-4zm2 4v3h3l-3 5v-3h-3l3-5z" fill="#aaaaaa"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/ac-adapter-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4a2 2 0 1 1 0 4v1H7V8h1a1 1 0 1 0-1-1H6a2 2 0 0 1 2-2zm-1 6h1v1H7z" class="warning" fill="#f57900"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-missing-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-missing-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1z" fill="#555555" opacity=".3"/>' \
        ' <path d="m3 3v11c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-11z" fill="#555555"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-90-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-90-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" fill="#555555" opacity=".3"/>' \
        ' <path d="m3 3v11c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-11zm5 2v3h3l-3 5v-3h-3z" class="success" fill="#8fd68f"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-90-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-90-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1z" opacity=".3" fill="#555555"/><path d="M3 6v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6z" fill="#555555"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-80-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-80-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#555555"/><path d="M3 6v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6H8v2h3l-3 5v-3H5l2.4-4z" class="success" fill="#8fd68f"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-80-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-80-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1z" fill="#555555" opacity=".3"/>' \
        ' <path d="m3 5v9c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-9z" fill="#555555"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-70-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-70-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" fill="#555555" opacity=".3"/>' \
        ' <path d="m3 5v9a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-9h-5v3h3l-3 5v-3h-3l3-5h-5z" class="success" fill="#8fd68f"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-70-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-70-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1z" opacity=".3" fill="#555555"/><path d="M3 8v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8z" fill="#555555"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-60-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-60-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#555555"/><path d="M3 8v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8h-2l-3 5v-3H5l1.2-2z" class="success" fill="#8fd68f"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-60-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-60-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1z" fill="#555555" opacity=".3"/>' \
        ' <path d="m3 8v6c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-6z" fill="#555555"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-50-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-50-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#555555"/><path d="M3 8v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8h-2l-3 5v-3H5l1.2-2z" class="success" fill="#8fd68f"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-50-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-50-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1z" opacity=".3" fill="#555555"/><path d="M3 10v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-4z" fill="#555555"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-40-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-40-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#555555"/><path d="M3 10v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-4H9.801L8 13v-3H5z" class="success" fill="#8fd68f"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-40-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-40-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1z" fill="#555555" opacity=".3"/>' \
        ' <path d="m3 11v3c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-3z" class="warning" fill="#ff7f2a"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-30-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-30-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" fill="#555555" opacity=".3"/>' \
        ' <path d="m3 11v3a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-3h-3.8008l-1.1992 2v-2h-5z" class="warning" fill="#ff7f2a"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-30-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-30-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path class="error" d="m10 1v1h3s-3e-5 0.446-3e-5 1v11c0 0.554-0.446 1-1 1h-8c-0.554 0-1-0.446-1-1v-11c0-0.554 3e-5 -1 3e-5 -1h3v-1z" fill="#e74c3c" opacity=".35"/>' \
        ' <path class="error" d="m13 12v2c0 0.554-0.446 1-1 1h-8c-0.554 0-1-0.446-1-1v-2z" fill="#e74c3c"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-20-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-20-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" class="error" fill="#e74c3c" opacity=".35"/>' \
        ' <path d="m3 13v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h-5-5z" class="error" fill="#e74c3c"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-20-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-20-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v1 11c0 0.554 0.446 1 1 1h4.7129c-1.0343-0.82662-1.7129-2.0821-1.7129-3.5 0-2.4734 2.0266-4.5 4.5-4.5 0.52807 0 1.028 0.10993 1.5 0.2793v-4.2793-1h-3v-1h-4zm4 8.6172c-0.57873 0.45573-1 1.0799-1 1.8828s0.42127 1.4271 1 1.8828v-0.38281-1-2.3828z" class="error" fill="#e74c3c" opacity=".35"/>' \
        ' <path d="m3 13v1c0 0.554 0.446 1 1 1h4.7129c-0.6491-0.51876-1.1482-1.2047-1.4336-2h-4.2793zm6.5918 0c0.12301 0.13878 0.26017 0.26624 0.4082 0.38281v-0.38281h-0.4082z" class="error" fill="#e74c3c"/>' \
        ' <path class="warning" d="m11.5 8a3.5 3.5 0 0 0-3.5 3.5 3.5 3.5 0 0 0 3.5 3.5 3.5 3.5 0 0 0 3.5-3.5 3.5 3.5 0 0 0-3.5-3.5zm-0.5 1h1v3h-1v-3zm0 4h1v1h-1v-1z" fill="#ff7f2a"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-10-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-10-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" class="error" fill="#e74c3c" opacity=".35"/>' \
        ' <path d="m3 13v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h-5-5z" class="error" fill="#e74c3c"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-level-10-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-level-10-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1z" fill="#555555"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-full-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-full-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" class="success" fill="#8fd68f"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-full-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-full-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" fill="#555555"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-full-charged-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-full-charged-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path class="error" d="m5.9998 1.0034v1h-3v12c2e-5 1 1 1 1 1h8c1 0 1-1 1-1v-12h-3v-1zm1 3h2v4l-0.25 2h-1.5l-0.25-2zm0 7h2v2h-2z" fill="#e74c3c"/>' \
        '</svg>' | tee $diretorio_base/Tela/symbolic/status/battery-empty-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-empty-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#555555"/></svg>' | tee $diretorio_base/Tela/symbolic/status/battery-empty-charging-symbolic.svg > $diretorio_base/Tela-light/symbolic/status/battery-empty-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4a2 2 0 1 1 0 4v1H7V8h1a1 1 0 1 0-1-1H6a2 2 0 0 1 2-2zm-1 6h1v1H7z" class="warning" fill="#f57900"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-missing-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1z" fill="#aaaaaa" opacity=".3"/>' \
        ' <path d="m3 3v11c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-11z" fill="#aaaaaa"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-90-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" fill="#aaaaaa" opacity=".3"/>' \
        ' <path d="m3 3v11c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-11zm5 2v3h3l-3 5v-3h-3z" class="success" fill="#8fd68f"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-90-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1z" opacity=".3" fill="#aaaaaa"/><path d="M3 6v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6z" fill="#aaaaaa"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-80-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#aaaaaa"/><path d="M3 6v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6H8v2h3l-3 5v-3H5l2.4-4z" class="success" fill="#8fd68f"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-80-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1z" fill="#aaaaaa" opacity=".3"/>' \
        ' <path d="m3 5v9c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-9z" fill="#aaaaaa"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-70-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" fill="#aaaaaa" opacity=".3"/>' \
        ' <path d="m3 5v9a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-9h-5v3h3l-3 5v-3h-3l3-5h-5z" class="success" fill="#8fd68f"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-70-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1z" opacity=".3" fill="#aaaaaa"/><path d="M3 8v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8z" fill="#aaaaaa"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-60-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#aaaaaa"/><path d="M3 8v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8h-2l-3 5v-3H5l1.2-2z" class="success" fill="#8fd68f"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-60-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1z" fill="#aaaaaa" opacity=".3"/>' \
        ' <path d="m3 8v6c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-6z" fill="#aaaaaa"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-50-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#aaaaaa"/><path d="M3 8v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V8h-2l-3 5v-3H5l1.2-2z" class="success" fill="#8fd68f"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-50-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1z" opacity=".3" fill="#aaaaaa"/><path d="M3 10v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-4z" fill="#aaaaaa"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-40-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#aaaaaa"/><path d="M3 10v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-4H9.801L8 13v-3H5z" class="success" fill="#8fd68f"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-40-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1z" fill="#aaaaaa" opacity=".3"/>' \
        ' <path d="m3 11v3c0 0.55228 0.44772 1 1 1h8c0.55228 0 1-0.44772 1-1v-3z" class="warning" fill="#ff7f2a"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-30-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" fill="#aaaaaa" opacity=".3"/>' \
        ' <path d="m3 11v3a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-3h-3.8008l-1.1992 2v-2h-5z" class="warning" fill="#ff7f2a"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-30-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path class="error" d="m10 1v1h3s-3e-5 0.446-3e-5 1v11c0 0.554-0.446 1-1 1h-8c-0.554 0-1-0.446-1-1v-11c0-0.554 3e-5 -1 3e-5 -1h3v-1z" fill="#e74c3c" opacity=".35"/>' \
        ' <path class="error" d="m13 12v2c0 0.554-0.446 1-1 1h-8c-0.554 0-1-0.446-1-1v-2z" fill="#e74c3c"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-20-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" class="error" fill="#e74c3c" opacity=".35"/>' \
        ' <path d="m3 13v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h-5-5z" class="error" fill="#e74c3c"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-20-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v1 11c0 0.554 0.446 1 1 1h4.7129c-1.0343-0.82662-1.7129-2.0821-1.7129-3.5 0-2.4734 2.0266-4.5 4.5-4.5 0.52807 0 1.028 0.10993 1.5 0.2793v-4.2793-1h-3v-1h-4zm4 8.6172c-0.57873 0.45573-1 1.0799-1 1.8828s0.42127 1.4271 1 1.8828v-0.38281-1-2.3828z" class="error" fill="#e74c3c" opacity=".35"/>' \
        ' <path d="m3 13v1c0 0.554 0.446 1 1 1h4.7129c-0.6491-0.51876-1.1482-1.2047-1.4336-2h-4.2793zm6.5918 0c0.12301 0.13878 0.26017 0.26624 0.4082 0.38281v-0.38281h-0.4082z" class="error" fill="#e74c3c"/>' \
        ' <path class="warning" d="m11.5 8a3.5 3.5 0 0 0-3.5 3.5 3.5 3.5 0 0 0 3.5 3.5 3.5 3.5 0 0 0 3.5-3.5 3.5 3.5 0 0 0-3.5-3.5zm-0.5 1h1v3h-1v-3zm0 4h1v1h-1v-1z" fill="#ff7f2a"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-10-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" enable-background="new" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="m6 1v1h-3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-12h-3v-1zm2 4v3h3l-3 5v-3h-3z" class="error" fill="#e74c3c" opacity=".35"/>' \
        ' <path d="m3 13v1a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h-5-5z" class="error" fill="#e74c3c"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-level-10-charging-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1z" fill="#aaaaaa"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-full-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" class="success" fill="#8fd68f"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-full-charging-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" fill="#aaaaaa"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-full-charged-symbolic.svg

    printf '%s\n' \
        '<svg width="16" height="16" version="1.1" xmlns="http://www.w3.org/2000/svg">' \
        ' <path class="error" d="m5.9998 1.0034v1h-3v12c2e-5 1 1 1 1 1h8c1 0 1-1 1-1v-12h-3v-1zm1 3h2v4l-0.25 2h-1.5l-0.25-2zm0 7h2v2h-2z" fill="#e74c3c"/>' \
        '</svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-empty-symbolic.svg

    echo '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="M6 1v1H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2h-3V1zm2 4v3h3l-3 5v-3H5z" opacity=".3" fill="#aaaaaa"/></svg>' > $diretorio_base/Tela-dark/symbolic/status/battery-empty-charging-symbolic.svg

    printf '%s\n' \
        '<?xml version="1.0" encoding="UTF-8" standalone="no"?>'              \
        '<!-- Created with Inkscape (http://www.inkscape.org/) -->'           \
        ''                                                                    \
        '<svg'                                                                \
        'xmlns:dc="http://purl.org/dc/elements/1.1/"'                         \
        'xmlns:cc="http://creativecommons.org/ns#"'                           \
        'xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"'             \
        'xmlns:svg="http://www.w3.org/2000/svg"'                              \
        'xmlns="http://www.w3.org/2000/svg"'                                  \
        'xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"' \
        'xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"'        \
        'width="140"'                                                         \
        'height="140"'                                                        \
        'id="svg4589"'                                                        \
        'sodipodi:version="0.32"'                                             \
        'inkscape:version="0.91 r13725"'                                      \
        'version="1.0"'                                                       \
        'sodipodi:docname="start-here-branding.svg"'                          \
        'inkscape:output_extension="org.inkscape.output.svg.inkscape"'        \
        'inkscape:export-filename="/home/jimmac/gfx/novell/pdes.local/trunk/logos/openSUSE/geeko-button.png"' \
        'inkscape:export-xdpi="36"'                                           \
        'inkscape:export-ydpi="36">'                                          \
        '<defs'                                                               \
        '   id="defs4591">'                                                   \
        '   <style'                                                           \
        '      type="text/css"'                                               \
        '      id="current-color-scheme">'                                    \
        '      .ColorScheme-Text {'                                           \
        '      color:#4d4d4d;'                                                \
        '      }'                                                             \
        '      </style>'                                                      \
        '</defs>'                                                             \
        '<sodipodi:namedview'                                                 \
        '   id="base"'                                                        \
        '   pagecolor="#ffffff"'                                              \
        '   bordercolor="#d8d8d8"'                                            \
        '   borderopacity="1"'                                                \
        '   gridtolerance="10000"'                                            \
        '   guidetolerance="10"'                                              \
        '   objecttolerance="10"'                                             \
        '   inkscape:pageopacity="0.0"'                                       \
        '   inkscape:pageshadow="2"'                                          \
        '   inkscape:zoom="1"'                                                \
        '   inkscape:cx="82.58269"'                                           \
        '   inkscape:cy="66.40506"'                                           \
        '   inkscape:document-units="px"'                                     \
        '   inkscape:current-layer="layer1"'                                  \
        '   width="200px"'                                                    \
        '   height="200px"'                                                   \
        '   borderlayer="true"'                                               \
        '   inkscape:showpageshadow="false"'                                  \
        '   inkscape:window-width="1366"'                                     \
        '   inkscape:window-height="739"'                                     \
        '   inkscape:window-x="0"'                                            \
        '   inkscape:window-y="0"'                                            \
        '   showgrid="false"'                                                 \
        '   fit-margin-top="0"'                                               \
        '   fit-margin-left="0"'                                              \
        '   fit-margin-right="0"'                                             \
        '   fit-margin-bottom="0"'                                            \
        '   inkscape:window-maximized="1" />'                                 \
        '<metadata'                                                           \
        '   id="metadata4594">'                                               \
        '   <rdf:RDF>'                                                        \
        '      <cc:Work'                                                      \
        '         rdf:about="">'                                              \
        '      <dc:format>image/svg+xml</dc:format>'                          \
        '      <dc:type'                                                      \
        '         rdf:resource="http://purl.org/dc/dcmitype/StillImage" />'   \
        '      <dc:title></dc:title>'                                         \
        '      </cc:Work>'                                                    \
        '   </rdf:RDF>'                                                       \
        '</metadata>'                                                         \
        '<g'                                                                  \
        '   inkscape:label="Layer 1"'                                         \
        '   inkscape:groupmode="layer"'                                       \
        '   id="layer1"'                                                      \
        '   transform="translate(-30.15625,-29.84375)">'                      \
        '   <path'                                                            \
        '      style="font-size:20.48839951px;font-family:TrebuchetMS-Bold;fill:currentColor;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-miterlimit:4"' \
        '      d="m 100,30.15625 c -38.57068,0 -69.84375,31.269508 -69.84375,69.84375 0,38.57424 31.273072,69.84375 69.84375,69.84375 38.57068,0 69.84374,-31.26951 69.84375,-69.84375 0,-38.57424 -31.27307,-69.84375 -69.84375,-69.84375 z m 0.33443,9.672652 c 33.23352,0 60.19682,26.941143 60.19682,60.171098 0,33.23353 -26.96686,60.1711 -60.19682,60.1711 -17.944821,0 -34.047203,-7.86473 -45.070445,-20.32286 4.532491,-3.51775 12.115629,-2.65954 21.454765,-1.59496 4.475525,0.50915 9.577453,1.09159 14.843405,1.20908 14.711895,0.0855 30.541335,-2.5996 40.311295,-6.86861 6.31629,-2.77006 10.36035,-4.59427 12.88829,-6.89434 0.91149,-0.7477 1.39015,-1.99679 1.87794,-3.29281 l 0.33442,-0.87466 c 0.40946,-1.04678 0.99706,-3.29926 1.26053,-4.52762 0.1175,-0.53764 0.17517,-1.1158 -0.2058,-1.41489 l -1.36343,0.25726 c -4.28682,2.57066 -14.99713,7.4667 -25.03056,7.66609 -12.43319,0.25991 -37.492093,-12.51643 -40.105489,-13.86585 l -0.257252,-0.3087 c -0.626644,-1.49541 -4.376768,-10.39808 -5.170752,-12.270896 18.037389,11.877766 32.991863,18.452076 44.453043,19.473926 12.74296,1.13224 22.683,-5.82499 26.93421,-8.79799 0.8296,-0.56612 1.46367,-1.01005 1.72359,-1.10618 l 0.28298,-0.46306 c -0.70498,-4.47909 -7.39073,-26.153517 -12.42525,-31.35894 -1.39571,-1.427752 -2.50536,-2.81725 -4.75915,-4.141747 C 114.08824,60.052429 70.821318,53.655843 68.795407,53.360325 l -0.334426,0.1029 -0.128626,0.282977 c 0,0 -0.162274,8.984421 -0.180076,9.981353 -1.484722,-0.491344 -6.088485,-1.998597 -12.682493,-3.80732 8.603733,-10.645844 21.789033,-20.091332 44.864644,-20.091333 z m 15.89813,31.847721 c 0.30705,-0.0046 0.61701,-0.01024 0.92611,0 10.20789,0.366729 18.22788,8.964457 17.87897,19.165228 -0.18159,4.934825 -2.26212,9.494349 -5.86533,12.862569 -3.6139,3.38602 -8.31087,5.1509 -13.27417,4.99068 -10.1901,-0.38097 -18.2101,-8.978697 -17.878976,-19.165231 0.174464,-4.941948 2.266486,-9.530764 5.891056,-12.888294 3.38468,-3.174391 7.71664,-4.895833 12.32234,-4.964952 z m -0.48878,5.453729 c -2.97293,0.180743 -5.77842,1.387872 -7.97479,3.447169 -2.50301,2.349915 -3.97993,5.531532 -4.0903,8.978073 -0.23499,7.120959 5.33713,13.113596 12.45097,13.377076 3.45722,0.10681 6.73667,-1.10438 9.26105,-3.447173 2.51726,-2.360599 3.98349,-5.571496 4.0903,-9.003798 0.23855,-7.131643 -5.35929,-13.102113 -12.47669,-13.351347 -0.43082,-0.01602 -0.83583,-0.02582 -1.26054,0 z m 3.39572,6.45701 c 3.16171,0 5.71099,1.718121 5.71098,3.833045 0,2.104248 -2.54927,3.833044 -5.71098,3.833046 -3.17239,0 -5.7367,-1.732365 -5.7367,-3.833046 0,-2.114922 2.56431,-3.833043 5.7367,-3.833045 z"'                                                             \
        '      id="path2445"'                                                  \
        '      class="ColorScheme-Text"'                                       \
        '      inkscape:connector-curvature="0" />'                            \
        '</g>'                                                                 \
        '</svg>' | tee $diretorio_base/Tela/32/status/start-here.svg > $diretorio_base/Tela/22/panel/start-here.svg

    # Remoção da herança do tema Breeze
    sed -i '/^Inherits=/ s/,breeze//; /^Inherits=/ s/breeze,//; /^Inherits=/ s/breeze//' $diretorio_base/Tela/index.theme
    sed -i '/^Inherits=/ s/,breeze//; /^Inherits=/ s/breeze,//; /^Inherits=/ s/breeze//' $diretorio_base/Tela-light/index.theme
    sed -i '/^Inherits=/ s/,breeze//; /^Inherits=/ s/breeze,//; /^Inherits=/ s/breeze//' $diretorio_base/Tela-dark/index.theme

    # Atualizando o cache de ícones
    gtk-update-icon-cache -q -f $diretorio_base/Tela
    gtk-update-icon-cache -q -f $diretorio_base/Tela-light
    gtk-update-icon-cache -q -f $diretorio_base/Tela-dark
}

criar_esquema_chameleon_breeze_dark(){
    printf '%s\n'                          \
        '[ColorEffects:Disabled]'          \
        'ChangeSelectionColor='            \
        'Color=56,56,56'                   \
        'ColorAmount=0'                    \
        'ColorEffect=0'                    \
        'ContrastAmount=0.65'              \
        'ContrastEffect=1'                 \
        'Enable='                          \
        'IntensityAmount=0.1'              \
        'IntensityEffect=2'                \
        ''                                 \
        '[ColorEffects:Inactive]'          \
        'ChangeSelectionColor=true'        \
        'Color=112,111,110'                \
        'ColorAmount=0.025'                \
        'ColorEffect=2'                    \
        'ContrastAmount=0.1'               \
        'ContrastEffect=2'                 \
        'Enable=false'                     \
        'IntensityAmount=0'                \
        'IntensityEffect=0'                \
        ''                                 \
        '[Colors:Button]'                  \
        'BackgroundAlternate=14,131,113'   \
        'BackgroundNormal=49,54,59'        \
        'DecorationFocus=0,164,137'        \
        'DecorationHover=0,164,137'        \
        'ForegroundActive=0,164,137'       \
        'ForegroundInactive=161,169,177'   \
        'ForegroundLink=0,164,137'         \
        'ForegroundNegative=218,68,83'     \
        'ForegroundNeutral=246,116,0'      \
        'ForegroundNormal=252,252,252'     \
        'ForegroundPositive=39,174,96'     \
        'ForegroundVisited=155,89,182'     \
        ''                                 \
        '[Colors:Complementary]'           \
        'BackgroundAlternate=30,87,116'    \
        'BackgroundNormal=42,46,50'        \
        'DecorationFocus=0,164,137'        \
        'DecorationHover=0,164,137'        \
        'ForegroundActive=0,164,137'       \
        'ForegroundInactive=161,169,177'   \
        'ForegroundLink=0,164,137'         \
        'ForegroundNegative=218,68,83'     \
        'ForegroundNeutral=246,116,0'      \
        'ForegroundNormal=252,252,252'     \
        'ForegroundPositive=39,174,96'     \
        'ForegroundVisited=155,89,182'     \
        ''                                 \
        '[Colors:Header]'                  \
        'BackgroundAlternate=42,46,50'     \
        'BackgroundNormal=49,54,59'        \
        'DecorationFocus=0,164,137'        \
        'DecorationHover=0,164,137'        \
        'ForegroundActive=0,164,137'       \
        'ForegroundInactive=161,169,177'   \
        'ForegroundLink=0,164,137'         \
        'ForegroundNegative=218,68,83'     \
        'ForegroundNeutral=246,116,0'      \
        'ForegroundNormal=252,252,252'     \
        'ForegroundPositive=39,174,96'     \
        'ForegroundVisited=155,89,182'     \
        ''                                 \
        '[Colors:Header][Inactive]'        \
        'BackgroundAlternate=49,54,59'     \
        'BackgroundNormal=42,46,50'        \
        'DecorationFocus=61,174,233'       \
        'DecorationHover=61,174,233'       \
        'ForegroundActive=61,174,233'      \
        'ForegroundInactive=161,169,177'   \
        'ForegroundLink=29,153,243'        \
        'ForegroundNegative=218,68,83'     \
        'ForegroundNeutral=246,116,0'      \
        'ForegroundNormal=252,252,252'     \
        'ForegroundPositive=39,174,96'     \
        'ForegroundVisited=155,89,182'     \
        ''                                 \
        '[Colors:Selection]'               \
        'BackgroundAlternate=8,123,105'    \
        'BackgroundNormal=8,123,105'       \
        'DecorationFocus=0,164,137'        \
        'DecorationHover=0,164,137'        \
        'ForegroundActive=0,164,137'       \
        'ForegroundInactive=255,255,255'   \
        'ForegroundLink=0,164,137'         \
        'ForegroundNegative=176,55,69'     \
        'ForegroundNeutral=198,92,0'       \
        'ForegroundNormal=255,255,255'     \
        'ForegroundPositive=23,104,57'     \
        'ForegroundVisited=155,89,182'     \
        ''                                 \
        '[Colors:Tooltip]'                 \
        'BackgroundAlternate=42,46,50'     \
        'BackgroundNormal=49,54,59'        \
        'DecorationFocus=0,164,137'        \
        'DecorationHover=0,164,137'        \
        'ForegroundActive=0,164,137'       \
        'ForegroundInactive=161,169,177'   \
        'ForegroundLink=0,164,137'         \
        'ForegroundNegative=218,68,83'     \
        'ForegroundNeutral=246,116,0'      \
        'ForegroundNormal=252,252,252'     \
        'ForegroundPositive=39,174,96'     \
        'ForegroundVisited=155,89,182'     \
        ''                                 \
        '[Colors:View]'                    \
        'BackgroundAlternate=35,38,41'     \
        'BackgroundNormal=27,30,32'        \
        'DecorationFocus=0,164,137'        \
        'DecorationHover=0,164,137'        \
        'ForegroundActive=0,164,137'       \
        'ForegroundInactive=161,169,177'   \
        'ForegroundLink=0,164,137'         \
        'ForegroundNegative=218,68,83'     \
        'ForegroundNeutral=246,116,0'      \
        'ForegroundNormal=252,252,252'     \
        'ForegroundPositive=39,174,96'     \
        'ForegroundVisited=155,89,182'     \
        ''                                 \
        '[Colors:Window]'                  \
        'BackgroundAlternate=49,54,59'     \
        'BackgroundNormal=42,46,50'        \
        'DecorationFocus=0,164,137'        \
        'DecorationHover=0,164,137'        \
        'ForegroundActive=0,164,137'       \
        'ForegroundInactive=161,169,177'   \
        'ForegroundLink=0,164,137'         \
        'ForegroundNegative=218,68,83'     \
        'ForegroundNeutral=246,116,0'      \
        'ForegroundNormal=252,252,252'     \
        'ForegroundPositive=39,174,96'     \
        'ForegroundVisited=155,89,182'     \
        ''                                 \
        '[General]'                        \
        'ColorScheme=ChameleonBreezeDark'  \
        'Name=Chameleon Breeze Dark'       \
        'shadeSortColumn=true'             \
        ''                                 \
        '[KDE]'                            \
        'contrast=4'                       \
        ''                                 \
        '[Icons]'                          \
        'Theme=Tela-dark'                  \
        ''                                 \
        '[WM]'                             \
        'activeBackground=49,54,59'        \
        'activeBlend=252,252,252'          \
        'activeForeground=252,252,252'     \
        'inactiveBackground=42,46,50'      \
        'inactiveBlend=161,169,177'        \
        'inactiveForeground=161,169,177'
}

criar_esquema_chameleon_breeze_darker(){
    printf '%s\n'                            \
        '[ColorEffects:Disabled]'            \
        'Color=112,111,110'                  \
        'ColorAmount=0'                      \
        'ColorEffect=0'                      \
        'ContrastAmount=0.65'                \
        'ContrastEffect=1'                   \
        'IntensityAmount=0.1'                \
        'IntensityEffect=2'                  \
        ''                                   \
        '[ColorEffects:Inactive]'            \
        'ChangeSelectionColor=true'          \
        'Color=112,111,110'                  \
        'ColorAmount=-0.9500000000000001'    \
        'ColorEffect=0'                      \
        'ContrastAmount=0.1'                 \
        'ContrastEffect=0'                   \
        'Enable=false'                       \
        'IntensityAmount=0'                  \
        'IntensityEffect=0'                  \
        ''                                   \
        '[Colors:Button]'                    \
        'BackgroundAlternate=20,25,31'       \
        'BackgroundNormal=20,25,31'          \
        'DecorationFocus=0,76,90'            \
        'DecorationHover=0,164,137'          \
        'ForegroundActive=222,222,222'       \
        'ForegroundInactive=190,207,210'     \
        'ForegroundLink=0,170,127'           \
        'ForegroundNegative=255,85,127'      \
        'ForegroundNeutral=0,129,149'        \
        'ForegroundNormal=252,252,252'       \
        'ForegroundPositive=0,164,137'       \
        'ForegroundVisited=127,140,141'      \
        ''                                   \
        '[Colors:Complementary]'             \
        'BackgroundAlternate=20,25,31'       \
        'BackgroundNormal=22,27,34'          \
        'DecorationFocus=0,76,90'            \
        'DecorationHover=44,120,107'         \
        'ForegroundActive=214,214,214'       \
        'ForegroundInactive=163,183,188'     \
        'ForegroundLink=44,120,107'          \
        'ForegroundNegative=255,85,127'      \
        'ForegroundNeutral=255,255,127'      \
        'ForegroundPositive=61,174,233'      \
        'ForegroundVisited=61,174,233'       \
        ''                                   \
        '[Colors:Selection]'                 \
        'BackgroundAlternate=20,25,31'       \
        'BackgroundNormal=0,164,137'         \
        'DecorationFocus=0,76,90'            \
        'DecorationHover=0,164,137'          \
        'ForegroundActive=190,207,210'       \
        'ForegroundInactive=60,174,230'      \
        'ForegroundLink=0,170,127'           \
        'ForegroundNegative=255,85,127'      \
        'ForegroundNeutral=0,129,149'        \
        'ForegroundNormal=252,252,252'       \
        'ForegroundPositive=0,164,137'       \
        'ForegroundVisited=191,210,211'      \
        ''                                   \
        '[Colors:Tooltip]'                   \
        'BackgroundAlternate=20,25,31'       \
        'BackgroundNormal=25,32,40'          \
        'DecorationFocus=0,76,90'            \
        'DecorationHover=0,164,137'          \
        'ForegroundActive=249,183,183'       \
        'ForegroundInactive=190,207,210'     \
        'ForegroundLink=0,170,127'           \
        'ForegroundNegative=255,85,127'      \
        'ForegroundNeutral=0,129,149'        \
        'ForegroundNormal=190,207,210'       \
        'ForegroundPositive=0,164,137'       \
        'ForegroundVisited=127,140,141'      \
        ''                                   \
        '[Colors:View]'                      \
        'BackgroundAlternate=20,25,31'       \
        'BackgroundNormal=20,25,31'          \
        'DecorationFocus=0,76,90'            \
        'DecorationHover=0,164,137'          \
        'ForegroundActive=222,222,222'       \
        'ForegroundInactive=137,153,158'     \
        'ForegroundLink=0,170,127'           \
        'ForegroundNegative=255,85,127'      \
        'ForegroundNeutral=0,129,149'        \
        'ForegroundNormal=252,252,252'       \
        'ForegroundPositive=0,164,137'       \
        'ForegroundVisited=127,140,141'      \
        ''                                   \
        '[Colors:Window]'                    \
        'BackgroundAlternate=20,25,31'       \
        'BackgroundNormal=20,25,31'          \
        'DecorationFocus=0,76,90'            \
        'DecorationHover=0,164,137'          \
        'ForegroundActive=207,207,207'       \
        'ForegroundInactive=190,207,210'     \
        'ForegroundLink=0,170,127'           \
        'ForegroundNegative=255,85,127'      \
        'ForegroundNeutral=0,129,149'        \
        'ForegroundNormal=252,252,252'       \
        'ForegroundPositive=0,164,137'       \
        'ForegroundVisited=127,140,141'      \
        ''                                   \
        '[General]'                          \
        'ColorScheme=ChameleonBreezeDarker'  \
        'Name=Chameleon Breeze Darker'       \
        'TitlebarIsAccentColored=true'       \
        'shadeSortColumn=true'               \
        ''                                   \
        '[KDE]'                              \
        'contrast=4'                         \
        ''                                   \
        '[WM]'                               \
        'activeBackground=20,25,31'          \
        'activeBlend=20,25,31'               \
        'activeForeground=190,207,210'       \
        'inactiveBackground=20,25,31'        \
        'inactiveBlend=20,25,31'             \
        'inactiveForeground=127,140,141'
}

criar_arquivo_kdeglobals(){
    printf '%s\n'                                                          \
        '[ColorEffects:Disabled]'                                          \
        'ChangeSelectionColor='                                            \
        'Color=112,111,110'                                                \
        'ColorAmount=0'                                                    \
        'ColorEffect=0'                                                    \
        'ContrastAmount=0.65'                                              \
        'ContrastEffect=1'                                                 \
        'Enable='                                                          \
        'IntensityAmount=0.1'                                              \
        'IntensityEffect=2'                                                \
        ''                                                                 \
        '[ColorEffects:Inactive]'                                          \
        'ChangeSelectionColor=true'                                        \
        'Color=112,111,110'                                                \
        'ColorAmount=-0.9500000000000001'                                  \
        'ColorEffect=0'                                                    \
        'ContrastAmount=0.1'                                               \
        'ContrastEffect=0'                                                 \
        'Enable=false'                                                     \
        'IntensityAmount=0'                                                \
        'IntensityEffect=0'                                                \
        ''                                                                 \
        '[Colors:Button]'                                                  \
        'BackgroundAlternate=20,25,31'                                     \
        'BackgroundNormal=20,25,31'                                        \
        'DecorationFocus=0,76,90'                                          \
        'DecorationHover=0,164,137'                                        \
        'ForegroundActive=222,222,222'                                     \
        'ForegroundInactive=190,207,210'                                   \
        'ForegroundLink=0,170,127'                                         \
        'ForegroundNegative=255,85,127'                                    \
        'ForegroundNeutral=0,129,149'                                      \
        'ForegroundNormal=252,252,252'                                     \
        'ForegroundPositive=0,164,137'                                     \
        'ForegroundVisited=127,140,141'                                    \
        ''                                                                 \
        '[Colors:Complementary]'                                           \
        'BackgroundAlternate=20,25,31'                                     \
        'BackgroundNormal=22,27,34'                                        \
        'DecorationFocus=0,76,90'                                          \
        'DecorationHover=44,120,107'                                       \
        'ForegroundActive=214,214,214'                                     \
        'ForegroundInactive=163,183,188'                                   \
        'ForegroundLink=44,120,107'                                        \
        'ForegroundNegative=255,85,127'                                    \
        'ForegroundNeutral=255,255,127'                                    \
        'ForegroundPositive=61,174,233'                                    \
        'ForegroundVisited=61,174,233'                                     \
        ''                                                                 \
        '[Colors:Selection]'                                               \
        'BackgroundAlternate=20,25,31'                                     \
        'BackgroundNormal=0,164,137'                                       \
        'DecorationFocus=0,76,90'                                          \
        'DecorationHover=0,164,137'                                        \
        'ForegroundActive=190,207,210'                                     \
        'ForegroundInactive=60,174,230'                                    \
        'ForegroundLink=0,170,127'                                         \
        'ForegroundNegative=255,85,127'                                    \
        'ForegroundNeutral=0,129,149'                                      \
        'ForegroundNormal=252,252,252'                                     \
        'ForegroundPositive=0,164,137'                                     \
        'ForegroundVisited=191,210,211'                                    \
        ''                                                                 \
        '[Colors:Tooltip]'                                                 \
        'BackgroundAlternate=20,25,31'                                     \
        'BackgroundNormal=25,32,40'                                        \
        'DecorationFocus=0,76,90'                                          \
        'DecorationHover=0,164,137'                                        \
        'ForegroundActive=249,183,183'                                     \
        'ForegroundInactive=190,207,210'                                   \
        'ForegroundLink=0,170,127'                                         \
        'ForegroundNegative=255,85,127'                                    \
        'ForegroundNeutral=0,129,149'                                      \
        'ForegroundNormal=190,207,210'                                     \
        'ForegroundPositive=0,164,137'                                     \
        'ForegroundVisited=127,140,141'                                    \
        ''                                                                 \
        '[Colors:View]'                                                    \
        'BackgroundAlternate=20,25,31'                                     \
        'BackgroundNormal=20,25,31'                                        \
        'DecorationFocus=0,76,90'                                          \
        'DecorationHover=0,164,137'                                        \
        'ForegroundActive=222,222,222'                                     \
        'ForegroundInactive=137,153,158'                                   \
        'ForegroundLink=0,170,127'                                         \
        'ForegroundNegative=255,85,127'                                    \
        'ForegroundNeutral=0,129,149'                                      \
        'ForegroundNormal=252,252,252'                                     \
        'ForegroundPositive=0,164,137'                                     \
        'ForegroundVisited=127,140,141'                                    \
        ''                                                                 \
        '[Colors:Window]'                                                  \
        'BackgroundAlternate=20,25,31'                                     \
        'BackgroundNormal=20,25,31'                                        \
        'DecorationFocus=0,76,90'                                          \
        'DecorationHover=0,164,137'                                        \
        'ForegroundActive=207,207,207'                                     \
        'ForegroundInactive=190,207,210'                                   \
        'ForegroundLink=0,170,127'                                         \
        'ForegroundNegative=255,85,127'                                    \
        'ForegroundNeutral=0,129,149'                                      \
        'ForegroundNormal=252,252,252'                                     \
        'ForegroundPositive=0,164,137'                                     \
        'ForegroundVisited=127,140,141'                                    \
        ''                                                                 \
        '[General]'                                                        \
        'ColorSchemeHash=5508310af4509d3957ba12a0ade6f18efa27fbf5'         \
        'LastUsedCustomAccentColor=233,58,154'                             \
        'XftHintStyle=hintslight'                                          \
        'XftSubPixel=rgb'                                                  \
        'fixed=NotoMono Nerd Font Mono,9,-1,5,400,0,0,0,0,0,0,0,0,0,0,1'   \
        'font=Open Sans,10,-1,5,400,0,0,0,0,0,0,0,0,0,0,1'                 \
        'menuFont=Open Sans,10,-1,5,400,0,0,0,0,0,0,0,0,0,0,1'             \
        'smallestReadableFont=Open Sans,9,-1,5,400,0,0,0,0,0,0,0,0,0,0,1'  \
        'toolBarFont=Open Sans,10,-1,5,400,0,0,0,0,0,0,0,0,0,0,1'          \
        ''                                                                 \
        '[Icons]'                                                          \
        'Theme=Tela-dark'                                                  \
        ''                                                                 \
        '[KDE]'                                                            \
        'LookAndFeelPackage=org.kde.breezedark.desktop'                    \
        ''                                                                 \
        '[KFileDialog Settings]'                                           \
        'Allow Expansion=false'                                            \
        'Automatically select filename extension=true'                     \
        'Breadcrumb Navigation=true'                                       \
        'Decoration position=2'                                            \
        'LocationCombo Completionmode=5'                                   \
        'PathCombo Completionmode=5'                                       \
        'Show Bookmarks=false'                                             \
        'Show Full Path=false'                                             \
        'Show Inline Previews=true'                                        \
        'Show Preview=false'                                               \
        'Show Speedbar=true'                                               \
        'Show hidden files=false'                                          \
        'Sort by=Name'                                                     \
        'Sort directories first=true'                                      \
        'Sort hidden files last=false'                                     \
        'Sort reversed=false'                                              \
        'Speedbar Width=144'                                               \
        'View Style=DetailTree'                                            \
        ''                                                                 \
        '[WM]'                                                             \
        'activeBackground=20,25,31'                                        \
        'activeBlend=20,25,31'                                             \
        'activeFont=Open Sans,11,-1,5,700,0,0,0,0,0,0,0,0,0,0,1,Bold'      \
        'activeForeground=190,207,210'                                     \
        'inactiveBackground=20,25,31'                                      \
        'inactiveBlend=20,25,31'                                           \
        'inactiveForeground=127,140,141'
}

ajuda(){
    echo -e "\nSintaxe: ./$0 [opções]"
    echo -e "\nOpções:"
    echo -e "  -r, --raiz <partição>        Partição onde o sistema será instalado (ex.: sda2)"
    echo -e "  -b, --boot <dispositivo>     Dispositivo de inicialização (ex.: sda) ou partição EFI (ex.: sda1)"
    echo -e "  -S, --senha-root <senha>     Senha para o superusuário root"
    echo -e "  -u, --usuario <nome>         Nome do usuário a ser criado (ex.: joao)"
    echo -e "  -s, --senha <senha>          Senha para o novo usuário"
    echo -e "  -n, --nome-completo <nome>   Nome completo para o novo usuário (ex.: João Pedro)"
    echo -e "  -H, --hostname <nome>        Nome do computador (não pode conter espaços) (ex.: meupc)"
    echo -e "  -l, --laptop <s|n>           Especifica se a instalação será realizada em um portátil. Se nenhum"
    echo -e "                               valor for informado, será assumido que sim"
    echo -e "  -h, --help, -a, --ajuda      Exibe essa mensagem de ajuda"
    echo -e "\nExemplo de uso:"
    echo -e "  ./$0 -r sda2 -b sda1 -S senha_root -u joao -s senha_usuario -n \"João Pedro\" -H meupc -l s"
}

mensagem_erro_argumento_ignorado(){
    argumento="$1"

    printf "$vermelho"
    echo -e "\nO argumento \"$argumento\" precisa de um valor. Por favor, continue respondendo abaixo ↓\n"
    printf "$normal"
}

mensagem_erro_valor_invalido(){
    argumento="$1"
    valor="$2"

    printf "$vermelho"
    echo -e "\nO valor \"$valor\" informado para \"$argumento\" não é válido. Por favor, continue respondendo abaixo ↓\n"
    printf "$normal"
}

### Variáveis preparatórias ###
destino=/mnt
log_zypper="/var/log/zypper.log"
tentivas_maximas=5
verde='\033[1;32m'
magenta='\033[1;35m'
vermelho='\033[1;31m'
normal='\033[0m'

### Processar os argumentos ###
while [[ $# -gt 0 ]]; do
    argumento="$1"
    case $argumento in
        -r|--raiz)
            if [[ "$2" == -* ]] || [[ -z "$2" ]]; then
                mensagem_erro_argumento_ignorado $argumento
            else
                particao_raiz_informada="$2"
                shift
            fi
            shift
            ;;
        -b|--boot)
            if [[ "$2" == -* ]] || [[ -z "$2" ]]; then
                mensagem_erro_argumento_ignorado $argumento
            else
                if [ -d /sys/firmware/efi ]; then
                    particao_EFI_informada=$2
                else
                    dispositivo_boot_informado=$2
                fi
                shift
            fi
            shift
            ;;
        -S|--senha-root)
            if [[ "$2" == -* ]] || [[ -z "$2" ]]; then
                mensagem_erro_argumento_ignorado $argumento
            else
                senha_root="$2"
                shift
            fi
            shift
            ;;
        -u|--usuario)
            if [[ "$2" == -* ]] || [[ -z "$2" ]]; then
                mensagem_erro_argumento_ignorado $argumento
            else
                usuario="$2"
                shift
            fi
            shift
            ;;
        -s|--senha)
            if [[ "$2" == -* ]] || [[ -z "$2" ]]; then
                mensagem_erro_argumento_ignorado $argumento
            else
                senha="$2"
                shift
            fi
            shift
            ;;
        -n|--nome-completo)
            if [[ "$2" == -* ]] || [[ -z "$2" ]]; then
                mensagem_erro_argumento_ignorado $argumento
            else
                nome_completo="$2"
                shift
            fi
            shift
            ;;
        -H|--nome-computador|--hostname)
            if [[ "$2" == -* ]] || [[ -z "$2" ]]; then
                mensagem_erro_argumento_ignorado $argumento
            else
                nome_computador="$2"
                shift
            fi
            shift
            ;;
        -l|--laptop)
            if [[ "$2" == -* ]] || [[ -z "$2" ]]; then
                laptop="s"
            else
                laptop="$2"
                if [[ "$laptop" != [sSnN] ]]; then
                    mensagem_erro_valor_invalido "$argumento" "$laptop"
                fi
                shift
            fi
            shift
            ;;
        -h|--help|-a|--ajuda)
            ajuda
            exit 0
            ;;
        *)
            printf "$vermelho"
            echo -e "\nO argumento \"$argumento\" não é reconhecido. Por favor, verifique a sintaxe do comando.\n"
            printf "$normal"
            ajuda
            exit 1
            ;;
    esac
done

# Verifica se o comando zypper está presente
if ! command -v "zypper" &> /dev/null; then
    printf "$vermelho"
    echo -e "\n O comando \"zypper\" não foi encontrado. Este script foi feito para ser executado em sistemas openSUSE.$normal\n"
    printf "$verde"
    echo -e " No link abaixo, pode baixar um ISO Live CD do openSUSE Tumbleweed:"
    echo -e "     https://download.opensuse.org/tumbleweed/iso/openSUSE-Tumbleweed-XFCE-Live-x86_64-Current.iso\n"
    echo -e " Após baixar o ISO, grave-o em um pendrive e dê boot por ele. Em seguida, abra um terminal execute este script.\n"
    printf "$normal"
    exit 1
fi

# Verifica se o usuário é o root
if [ "$EUID" -ne 0 ]; then
    printf "$vermelho"
    echo -e "\n Este script precisa ser executado como root.\n"
    printf "$verde"
    echo -e " Para tal, utilize o comando \"sudo $0\" ou"
    echo -e " execute-o como usuário root, usando os comandos:\n"
    echo -e " \"sudo su\" e em seguida \"$0\".\n"
    printf "$normal"
    exit 1
fi


### Mensagem de boas vindas ###
echo -e "\nOlá!! Este é o script de instalação completa do openSUSE Tumbleweed! Nesse tipo de instalação, serão instalados os pacotes principais e suas dependências, bem como pacotes sugeridos, ou seja, pacotes que não são necessários para o funcionamento das aplicações que serão instaladas, mas que podem adicionar recurso extra. Um exemplo disso são os pacotes de tradução. Neste script, os pacotes de tradução serão instalados explicitamente para evitar que alguma tradução acabe faltando."
echo -e "\nNo mais, aproveite!!\n"

### Identificação da CPUs presentes ###
cpu_info=$(grep -o -m 1 'vendor_id.*' /proc/cpuinfo | cut -d ':' -f 2 | tr -d '[:space:]')

if [ "$cpu_info" == "GenuineIntel" ]; then
    iGPU="intel"
    pacotes_intel_cpu="ucode-intel thermald thermal-monitor"
elif [ "$cpu_info" == "AuthenticAMD" ]; then
    iGPU="amd"
    pacotes_amd_cpu="ucode-amd"
fi

### Identificação das GPUs presentes ###
gpu_info=$(lspci | grep -E "VGA|3D controller")
num_gpus=$(echo "$gpu_info" | wc -l)

if echo "$gpu_info" | grep -qi 'Intel'; then
    pacotes_intel_gpu="intel-gpu-tools intel-media-driver intel-hybrid-driver intel-vaapi-driver libvulkan_intel"
fi

if echo "$gpu_info" | grep -qi 'AMD'; then
    pacotes_amd_gpu="radeontop radeontop-lang libvulkan_radeon libvdpau_radeonsi"
fi

if echo "$gpu_info" | grep -qi 'NVIDIA'; then
    # Nesse caso, os pacotes vêm de um repositório
    # próprio que será adicionado adiante
    instalar_nvidia="Sim"
fi


### Interação com o usuário para coletar os dados iniciais ###
# ajuda

echo "════════════════════════════════════════════════════════"

while [[ -z $particao_raiz ]]; do
    if [ -z "$particao_raiz_informada" ]; then
        read -p "Partição onde o sistema será instalado [ex.: sda2]: " particao_raiz_informada
    else
        particao_raiz_informada=$(basename $particao_raiz_informada)
        particao_validada="$(valida_particao $particao_raiz_informada "ext4 btrfs" 16G)"

        if [[ "/dev/$particao_raiz_informada" == "$particao_validada" ]]; then
            particao_raiz="$particao_validada"

            if [ -z $ja_rodou ]; then
                mostra_preenchido "$particao_raiz" "$1" "Partição onde o sistema será instalado: "
            fi
            unset ja_rodou
        elif [ ! -z "$particao_raiz_informada" ]; then
            printf "$particao_validada\n"
            unset particao_raiz_informada
            ja_rodou="0"
        fi
    fi
done


## UEFI ou BIOS
if [ -d /sys/firmware/efi ]; then
    while [[ -z $particao_EFI ]]; do
        if [ -z "$particao_EFI_informada" ]; then
            read -p "Partição de inicialização EFI [ex.: sda1]: " particao_EFI_informada
        else
            particao_EFI_informada=$(basename $particao_EFI_informada)
            particao_validada="$(valida_particao $particao_EFI_informada "fat fat32 vfat fat16" 100M)"
    
            if [[ "/dev/$particao_EFI_informada" == "$particao_validada" ]]; then
                particao_EFI="$particao_validada"
   
                if [ -z $ja_rodou ]; then
                    mostra_preenchido "$particao_EFI" "$2" "Partição de inicialização EFI: "
                fi
                unset ja_rodou
            elif [ ! -z "$particao_EFI_informada" ]; then
                printf "$particao_validada\n"
                unset particao_EFI_informada
                ja_rodou="0"
            fi
        fi
    done
else
    while [[ -z $dispositivo_boot ]]; do
        if [ -z "$dispositivo_boot_informado" ]; then 
            read -p "Dispositivo de inicialização [ex.: sda]: " dispositivo_boot_informado
        else
            dispositivo_boot_informado=$(basename $dispositivo_boot_informado)
            dispositivo_boot_validado="$(valida_dispositivo $dispositivo_boot_informado)"
    
            if [[ "/dev/$dispositivo_boot_informado" == "$dispositivo_boot_validado" ]]; then 
                dispositivo_boot="$dispositivo_boot_validado"
   
                if [ -z $ja_rodou ]; then 
                    mostra_preenchido "$dispositivo_boot" "$2" "Dispositivo de inicialização: "
                fi   
                unset ja_rodou
            elif [ ! -z "$dispositivo_boot_informado" ]; then 
                printf "$dispositivo_boot_validado"
                unset dispositivo_boot_informado
                ja_rodou="0"
            fi   
        fi   
    done
fi


if [ -z "$senha_root" ]; then
    echo ""
    echo "╔═══════════════════════════════════════════════╗"
    echo "║                                               ║"
    echo "║ Definição de senha para o superusuário (root) ║"
    echo "║                                               ║"
    echo "╚═══════════════════════════════════════════════╝"

    printf "\n$magenta Por favor, escolha uma senha segura, pois este \n"
    printf " usuário pode realizar qualquer ação no sistema!! $normal\n\n"

    while [[ "$senha_root" != "$senha_root_redigitada" ]] || [[ -z "$senha_root" ]]
    do
        read -sp "Senha para o superusuário root (ficará oculta enquanto digitar): " senha_root
        echo
        read -sp "Confirme a senha: " senha_root_redigitada
        echo

        if [ "$senha_root" != "$senha_root_redigitada" ]; then
            echo -e "\nAs senhas digitadas são diferentes! Tente novamente.\n"
        fi
    done
else
    printf "\n$verde"
    printf "Senha para o usuário root: Já definida!$normal\n"
fi

echo -e "\n### Criação do seu usuário ###"

if [ -z "$usuario" ]; then
    read -p "Nome de usuário a ser criado: [ex.: joao]: " usuario
else
    printf "Nome de usuário a ser criado: [ex.: joao]: "
    printf "$verde"
    printf "$usuario"
    printf "$normal\n"
fi

if [ -z "$senha" ]; then
    while [[ "$senha" != "$senha_redigitada" ]] || [[ -z "$senha" ]]
    do
        read -sp "Senha para esse novo usuário (ficará oculta enquanto digitar): " senha
        echo
        read -sp "Confirme a senha: " senha_redigitada
        echo

        if [ "$senha" != "$senha_redigitada" ]; then
            echo -e "\nAs senhas digitadas são diferentes! Tente novamente.\n"
        fi
    done
else
    printf "$verde"
    printf "Senha para o novo usuário \"$usuario\": Já definida!"
    printf "$normal\n"
fi

if [ -z "$nome_completo" ]; then
    read -p "Nome completo para o novo usuário [ex.: João Pedro]: " nome_completo
else
    printf "Nome completo para o novo usuário [ex.: João Pedro]: "
    printf "$verde"
    printf "$nome_completo"
    printf "$normal\n"
fi

if [ -z "$nome_computador" ]; then
    read -p "Nome do computador (não pode conter espaços) [ex.: meupc]: " nome_computador
else
    printf "Nome do computador (não pode conter espaços) [ex.: meupc]: "
    printf "$verde"
    printf "$nome_computador"
    printf "$normal\n"
fi

if [ -z "$laptop" ] || [[ "$laptop" != [sSnN] ]]; then
    while [[ "$laptop" != [sSnN] ]]; do
        read -p "A instalação será realizada em um notebook? [S/N] " laptop
    done
else
    printf "A instalação será realizada em um notebook? [S/N] "
    printf "$verde"
    printf "$laptop"
    printf "$normal\n"
fi

echo -e "\nInformações coletadas:"
printf " - Partição onde o sistema será instalado: "
printf "$verde"
printf "$particao_raiz"
printf "$normal\n"

## UEFI ou BIOS
if [ -d /sys/firmware/efi ]; then
    printf " - Partição de inicialização EFI: "
    printf "$verde"
    printf "$particao_EFI" 
    printf "$normal\n"
else
    printf " - Dispositivo onde ocorrerá o boot: "
    printf "$verde"
    printf "$dispositivo_boot"
    printf "$normal\n"
fi

printf " - Nome de usuário a ser criado: "
printf "$verde"
printf "$usuario"
printf "$normal\n"

printf " - Nome completo para o novo usuário: "
printf "$verde"
printf "$nome_completo"
printf "$normal\n"

printf " - Nome do computador: "
printf "$verde"
printf "$nome_computador"
printf "$normal\n"

printf " - Suporte para placas de vídeo da NVIDIA: "

if [[ "$instalar_nvidia" == "Sim" ]]; then
    printf "$verde"
    printf "Sim"
    printf "$normal\n"
else
    printf "$vermelho"
    printf "Não"
    printf "$normal\n"
fi

echo -n " - Instalação em notebook: "

if [[ "$laptop" == [sS] ]]; then
    printf "$verde"
    echo "Sim"
    printf "$normal\n"
else
    printf "$vermelho"
    echo "Não"
    printf "$normal\n"
fi

echo -e "\n"

while [[ "$resposta" != [sSnN] ]]; do
    read -p "As informações acima estão corretas? [S/N] " resposta
done

if [[ "$resposta" == [nN] ]]; then
    echo -e "\nA instalação foi cancelada e nada foi alterado no seu computador. Execute-a novamente para recomeçar."
    echo ""
    exit 0
fi

### Caso esteja em modo legado e com tabela de    ###
### partição do tipo GPT, cria a partição de boot ###
if [ ! -d /sys/firmware/efi ]; then
    tipo_tabela_particao=$(checa_tipo_tabela_de_particao $dispositivo_boot)

    if [[ "$tipo_tabela_particao" == "GPT" ]]; then
        particao_bios=$(checa_particao_bios $dispositivo_boot)

        if [ -z "$particao_bios" ]; then
            printf "$amarelo"
            echo -e "\nCriando partição de boot BIOS...\n"
            printf "$normal"

            printf "n\n\n34\n\nef02\nw\ny\n" | gdisk $dispositivo_boot > /dev/null 2>&1

            particao_bios=$(checa_particao_bios $dispositivo_boot)
            if [ -z "$particao_bios" ]; then
                printf "$vermelho"
                echo -e "\nA partição de boot BIOS não foi criada. Verifique se o dispositivo informado está correto.\n"
                printf "$normal"
                exit 1
            else
                printf "$verde"
                echo -e "\nPartição de boot BIOS criada com sucesso!\n"
                printf "$normal"
            fi
        fi
    fi
fi

### Montando a partição onde o sistema será instalado ###
mount $particao_raiz $destino

### Ajustando o Zypper para sempre aceitar as licenças ###
sed -i '/autoAgreeWithLicenses/ s/.*/autoAgreeWithLicenses = yes/' /etc/zypp/zypper.conf

### Instalação do sistema base ###
pacotes_iniciais="libz1 libz1-x86-64-v3 zypper-needs-restarting systemd-lang systemd-container ca-certificates ca-certificates-mozilla curl gawk grep-lang sed-lang tar-lang xz-lang gzip procps-lang procps which systemd-presets-branding-openSUSE suse-module-tools suse-module-tools-scriptlets diffutils-lang man man-pages man-pages-posix man-pages-pt_BR tuned-ppd rpm-repos-openSUSE-Tumbleweed openSUSE-repos-Tumbleweed glibc-locale"

comando_1="zypper refresh -f"
comando_2="zypper -n --ignore-unknown --installroot $destino install -y --auto-agree-with-licenses -t product openSUSE"
comando_3="zypper -n --ignore-unknown --installroot $destino install -y --auto-agree-with-licenses $pacotes_iniciais"
comando_4="zypper -n --installroot $destino addlocale pt_BR"
comando_5="zypper -n --root $destino modifyrepo --priority 80 --all"

tentar "$comando_1 && $comando_2 && $comando_3 && $comando_4 && $comando_5" $tentivas_maximas

### Criação do arquivo de configuração do gestor de inicialização ###
arquivo_bootloader > $destino/etc/sysconfig/bootloader

### Montando diretórios adicionais ###
mount --bind /sys $destino/sys
mount --bind /proc $destino/proc
mount --bind /dev $destino/dev
mkdir $destino/boot/efi

### Atualizando os certificados SSL ###
chroot $destino /usr/sbin/update-ca-certificates

### Ajustando o servidor de DNS ###
echo "nameserver 8.8.8.8" > $destino/etc/resolv.conf

### Instalando o restante dos pacotes do sistema base ###
echo -e "\nInstalando padrões do sistema base.\n"

comando_1="zypper -n --root $destino --gpg-auto-import-keys refresh -f"
comando_2="zypper -n --no-refresh --ignore-unknown --root $destino install --download-in-advance -y --auto-agree-with-licenses -t pattern base enhanced_base minimal_base basesystem"

tentar "$comando_1 && $comando_2" $tentivas_maximas

### Adicionando os repositórios extras ###
echo -e "\nAdicionando repositórios extras.\n"

echo "[Emulators]
name=Emulators
enabled=0
autorefresh=1
baseurl=http://download.opensuse.org/repositories/Emulators/openSUSE_Tumbleweed/
path=/
type=rpm-md
priority=100
keeppackages=0" > $destino/etc/zypp/repos.d/Emulators.repo

echo '[Multimedia_Proaudio]
name=Multimedia Proaudio
baseurl=http://download.opensuse.org/repositories/multimedia:/proaudio/openSUSE_Tumbleweed/
enabled=0
type=rpm-md
gpgcheck=1
priority=100
gpgkey=https://download.opensuse.org/repositories/multimedia:/proaudio/openSUSE_Tumbleweed/repodata/repomd.xml.key
autorefresh=1' > $destino/etc/zypp/repos.d/Multimedia_Proaudio.repo

if [[ $instalar_nvidia = "Sim" ]]; then
    echo -e '[NVIDIA]\nname=NVIDIA\nenabled=1\nautorefresh=1\nbaseurl=http://download.nvidia.com/opensuse/tumbleweed\ntype=rpm-md\nkeeppackages=0' > $destino/etc/zypp/repos.d/NVIDIA.repo
fi

echo '[Packman_Repository]
name=Packman Repository
enabled=1
autorefresh=1
baseurl=http://ftp.gwdg.de/pub/linux/misc/packman/suse/openSUSE_Tumbleweed/
path=/
type=rpm-md
priority=50
keeppackages=0' > $destino/etc/zypp/repos.d/packman.repo

echo '[VSCode]
name=VSCode
enabled=1
autorefresh=1
baseurl=https://packages.microsoft.com/yumrepos/vscode
type=rpm-md
priority=100
keeppackages=0' > $destino/etc/zypp/repos.d/vscode.repo

echo '[X2go]
name=X2Go
enabled=1
autorefresh=1
baseurl=http://download.opensuse.org/repositories/X11:/RemoteDesktop:/x2go/openSUSE_Tumbleweed
type=rpm-md
priority=100
keeppackages=0' > $destino/etc/zypp/repos.d/X2Go.repo

echo '[libdvdcss]
name=libdvdcss
enabled=1
autorefresh=1
baseurl=http://opensuse-guide.org/repo/openSUSE_Tumbleweed/
path=/
type=rpm-md
priority=100
keeppackages=0' > $destino/etc/zypp/repos.d/libdvdcss.repo

echo '[google-chrome]
name=google-chrome
enabled=1
autorefresh=1
baseurl=http://dl.google.com/linux/chrome/rpm/stable/x86_64
gpgcheck=1
gpgkey=http://dl.google.com/linux/linux_signing_key.pub
type=rpm-md
keeppackages=0' > $destino/etc/zypp/repos.d/google-chrome.repo

### Importando a chave do repositório do Visual Studio Code ###
comando_1="chroot $destino /usr/bin/rpm --import https://packages.microsoft.com/keys/microsoft.asc"

tentar "$comando_1" $tentivas_maximas

### Atualizando a lista de pacotes com aceitação automática das chaves GPG ###
zypper -n --root $destino --gpg-auto-import-keys refresh -f

### Atualizando lista de pacotes, aplicando atualizações,  ###
### instalando o restante do sistema base, instalando      ###
### componentes gráficos, a área de trabalho e ferramentas ###
### extras                                                 ###

echo -e "\nInstalando o restante do sistema base, componentes gráficos, a área de trabalho e ferramentas extras...\n"

arquivo_sinalizador="$(mktemp)"
mostra_espera "Validando os pacotes a serem instalados. Por favor, aguarde..." "$arquivo_sinalizador" &

tema_breeze="$(zypper search breeze | grep -o 'breeze[0-9]\+' | uniq)"
libavcodec="$(zypper search libavcodec | grep -o 'libavcodec[0-9]\+ ' | uniq | tr '\n' ' ')"

leap_url="https://download.opensuse.org/distribution/leap/15.6/repo/oss"
chaves_repo_leap=$(curl -sL "$leap_url" | grep -oP 'gpg-pubkey-[^"]+\.asc' | sort | uniq)

# Importando as chaves do repositório Leap 15.6 para a instalação
# dos pacotes package-update-indicator e package-update-indicator-lang
for chave in $chaves_repo_leap; do
    chroot $destino /usr/bin/rpm --import "$leap_url/$chave"
done

package_update_indicator_nome=$(curl -sL "$leap_url/x86_64" | grep -oP 'package-update-indicator-[^"]+\.rpm' | sort -V | tail -n1)
package_update_indicator_url="$leap_url/x86_64/$package_update_indicator_nome"

package_update_indicator_lang_nome=$(curl -sL "$leap_url/noarch" | grep -oP 'package-update-indicator-lang-[^"]+\.rpm' | sort -V | tail -n1)
package_update_indicator_lang_url="$leap_url/noarch/$package_update_indicator_lang_nome"

pacotes_base="kernel-default kernel-default-devel install-initrd-openSUSE NetworkManager-lang htop nload pipewire-lang pipewire-pulseaudio pipewire-alsa pipewire-aptx pipewire-module-x11-0_3 flatpak git ffmpeg-7 libvulkan1 unzip zip 7zip bzip2 unrar fish yt-dlp tealdeer-fish-completion tealdeer yt-dlp btop NetworkManager-bluetooth kernel-firmware-all yast2-control-center yast2-sudo yast2-trans-pt_BR yast2-sysconfig yast2-update yast2-services-manager yast2-security yast2-online-update yast2-online-update-configuration yast2-online-update-frontend yast2-installation xkeyboard-config-lang wget-lang glibc-lang glib-networking-lang glib2-lang chrony dejavu-fonts mkfontscale apparmor-utils-lang apparmor-parser-lang apparmor-abstractions terminus-bitmap-fonts firewalld-lang plymouth-theme-opensuse-beat yast2-ntp-client tree fastfetch libvirt avahi sensors cnf-locale btop rpmrebuild gcc-c++ gdb gdbm-lang fuse-overlayfs bat bat-extras bat-fish-completion man-pages-pt_BR make-lang accountsservice-lang dialog-lang net-tools-lang psmisc-lang plocate findutils-lang exo-lang diffutils-lang cryptsetup-lang cpio-lang coreutils-lang bison-lang udisks2-lang ntfsprogs-extra libfsntfs-tools wireless-regdb syslog-ng android-tools android-udev-rules earlyoom net-tools-deprecated v4l2loopback-utils v4l2loopback-kmp-default v4l2loopback-autoload whois nmap tcpdump netavark ncdu kexec-tools python313-Glances rclone opi libguestfs libguestfs-rsync libguestfs0 libguestfs-rescue update-bootloader-rpm-macros patterns-base-bootloader fwupd fwupd-lang susepaste libfsntfs1 libfsntfs-tools nvtop duf libnvme-mi1 libnvme1 nvme-cli lsd python313-pipx $pacotes_amd_cpu $pacotes_intel_cpu system-group-wheel sudo-policy-wheel-auth-self system-user-mail sof-firmware pv at sudo-policy-sudo-auth-self sudo-policy-wheel-auth-self system-group-sudo sshfs xf86-video-mach64 xf86-video-r128 biosdevname libxcb-dri2-0 cpufetch byobu tuned-utils kernel-longterm kernel-longterm-devel v4l2loopback-kmp-longterm"

componentes_graficos="xorg-x11-server-extra xorg-x11-driver-video xorg-x11-driver-input xinput xf86-input-joystick xorg-x11-fonts-core lightdm-lang lightdm-gtk-greeter-lang lightdm-gtk-greeter-settings-lang xscreensaver-data-extra gstreamer-plugins-ugly-codecs gstreamer-plugins-bad-codecs $libavcodec metatheme-adapta-common gtk3-metatheme-adapta gtk4-metatheme-adapta blueman-lang bluez NetworkManager-applet NetworkManager-connection-editor NetworkManager-connection-editor-lang polkit-gnome-lang libgnomesu0 xdg-desktop-portal-gtk-lang xdg-desktop-portal-lang xdg-terminal-exec yast2-theme-breeze opensuse-welcome gvfs-lang tumbler tumbler-lang tumbler-webp-thumbnailer sox libva-utils xclip xclipboard libgnomesu-lang fontconfig-lang gtk3-lang gsettings-desktop-schemas-lang gstreamer-lang gstreamer-plugins-bad-lang gstreamer-plugins-base-lang gstreamer-plugins-ugly-lang upower-lang zenity-lang gdk-pixbuf-lang colord-lang firewall-config xkill mugshot yast2-usbauth yast2-update-FACTORY yast2-testsuite yast2-multipath yast2-devtools autoyast2 yast2-installation-control yast2-configuration-management yast2-support patterns-yast-yast2_desktop yast2-tune yast2-kdump yast2-journal libdvdcss2 qsynth-lang gstreamer-plugins-bad-fluidsynth fluidsynth $pacotes_amd_gpu $pacotes_intel_gpu simplescreenrecorder google-noto-sans-cjk-fonts simple-scan-lang libgtkglext-x11-1_0-0 xdotool PackageKit-lang gnome-packagekit-lang gnome-packagekit-extras $package_update_indicator_url $package_update_indicator_lang_url firewall-applet firewall-config xhost susepaste-screenshot libqt5-qtimageformats distribution-logos-openSUSE-icons distribution-logos-openSUSE wallpapers-openSUSE-extra qpwgraph gdk-pixbuf-loader-libavif gdk-pixbuf-loader-libavif raw-thumbnailer jxl-thumbnailer rsvg-thumbnailer gdk-pixbuf-loader-rsvg xev $tema_breeze spice-vdagent dbus-1-daemon tuned-gtk texlive-tex-gyre-fonts"

ambiente_XFCE="xfce4-panel-lang xfce4-panel-profiles xfce4-panel-restore-defaults xfce4-power-manager-lang xfce4-pulseaudio-plugin-lang pavucontrol-lang xfce4-screensaver xfce4-screenshooter-lang xfce4-session-lang xfce4-settings-lang xfce4-terminal-lang xfce4-datetime-plugin-lang xfce4-genmon-plugin-lang xfce4-kbdleds-plugin-lang xfce4-notifyd-lang xfce4-panel-lang xfce4-pulseaudio-plugin-lang xfce4-systemload-plugin-lang xfce4-notifyd-theme-adapta xfwm4-lang xfwm4-theme-adapta thunar-lang thunar-sendto-blueman thunar-media-tags-plugin-lang thunar-shares-plugin-lang thunar-volman-branding-openSUSE thunar-volman-lang thunar-archive-plugin-lang thunar-font-manager xfdesktop-lang xfce4-settings-color xfce4-sensors-plugin-lang xfce4-battery-plugin-lang xfce4-appfinder-lang xfce4-xkb-plugin-lang xfce4-weather-plugin-lang xfce4-docklike-plugin xfce4-whiskermenu-plugin-lang xfce4-panel-plugin-indicator-lang xfce4-power-manager-plugin xfce4-power-manager-branding-openSUSE ristretto-lang nomacs-lang"

ferramentas_extras="myspell-dictionaries myspell-en myspell-en_US myspell-lightproof-en myspell-lightproof-pt_BR myspell-pt_BR okular-lang libKF6Archive6-lang vlc-qt vlc vlc-lang vlc-codec-gstreamer vlc-codecs gnome-calculator-lang kcolorchooser-lang gnome-disk-utility-lang libvirt-daemon-qemu qemu-linux-user qemu-linux-user libvirt-daemon-qemu virt-manager qt5ct kolourpaint-lang libqt5-qtxmlpatterns-imports libQt5WebChannel5-imports gparted-lang pluma-lang engrampa-lang libreoffice libreoffice-branding-openSUSE libreoffice-l10n-pt_BR libreoffice-l10n-en libreoffice-branding-openSUSE libreoffice-calc libreoffice-draw libreoffice-filters-optional libreoffice-gnome libreoffice-gtk3 libreoffice-icon-themes libreoffice-impress libreoffice-l10n-en libreoffice-l10n-pt_BR libreoffice-mailmerge libreoffice-math libreoffice-pyuno libreoffice-share-linker libreoffice-writer MozillaFirefox MozillaFirefox-branding-openSUSE MozillaFirefox-translations-common MozillaFirefox-translations-other transmission-gtk-lang baobab-lang code gearlever-lang qdirstat"

ambiente_de_trabalho="$ambiente_XFCE"
pacotes="$pacotes_base $componentes_graficos $ambiente_de_trabalho $ferramentas_extras"

rm -f "$arquivo_sinalizador"
valida_pacotes_visualizado "Validando os pacotes a serem instalados. Por favor, aguarde..." "$pacotes" "$log_zypper" "--root $destino" "pacotes_validados" "pacotes_pulados"

comando_1="zypper -n --root $destino --gpg-auto-import-keys refresh -f"
comando_2="zypper -n --no-refresh --root $destino dist-upgrade -y --download-in-advance --allow-vendor-change --no-recommends --auto-agree-with-licenses"
comando_3="zypper -n --no-refresh --ignore-unknown --root $destino install -y --allow-vendor-change --download-in-advance --auto-agree-with-licenses $pacotes_validados"
comando_4="zypper -n --no-refresh --ignore-unknown --root $destino install -y --allow-vendor-change --download-in-advance --auto-agree-with-licenses -t pattern apparmor fonts x11_yast x11"

tentar "$comando_1 ; $comando_2 & $comando_3 && $comando_4" $tentivas_maximas

# Remover os pacotes package-update-indicator e package-update-indicator-lang
# da base RPM para que não sejam desinstalados por acidente
chroot $destino /usr/bin/rpm -e --justdb package-update-indicator package-update-indicator-lang

### Garantia de compatibilidade com versões de criptografia antigas ###
chroot $destino /usr/bin/update-crypto-policies --set LEGACY

### Removendo links simbólicos de UUIDs antigos ###
UUIDs="$(lsblk -rno UUID | grep -v '^$')"

for caminho_link in /dev/disk/by-uuid/*; do
    [ -L "$caminho_link" ] || continue
    uuid_atual="$(basename -- "$caminho_link")"
    echo "$UUIDs" | grep -Fxq "$uuid_atual" || rm -f "$caminho_link"
done

### Ajustando os pontos de montagem no fstab (UEFI ou BIOS) ###
tipo_particao_raiz="$(tipo_particao $particao_raiz)"

if [ -d /sys/firmware/efi ]; then
    tipo_particao_EFI="$(tipo_particao $particao_EFI)"

    echo "UUID=$(/usr/bin/lsblk -f -no UUID "$particao_raiz") / $tipo_particao_raiz defaults 0 0" > $destino/etc/fstab
    echo "UUID=$(/usr/bin/lsblk -f -no UUID "$particao_EFI") /boot/efi $tipo_particao_EFI utf8 0 0" >> $destino/etc/fstab
else
    echo "UUID=$(/usr/bin/lsblk -f -no UUID "$particao_raiz") / $tipo_particao_raiz defaults 0 0" > $destino/etc/fstab
fi

### Instalação do grub (UEFI ou BIOS) ###
comando_1="zypper -n --root $destino refresh -f -r \"repo-oss\""

if [ -d /sys/firmware/efi ]; then
    echo -e "\nInstalando o GRUB em modo UEFI\n"
    comando_2="zypper -n --no-refresh --ignore-unknown --root $destino install -y --download-in-advance efitools efivar grub2-x86_64-efi-extras"
    tentar "$comando_1 ; $comando_2" $tentivas_maximas

    mount $particao_EFI $destino/boot/efi
    chroot $destino /usr/bin/mount -t efivarfs efivarfs /sys/firmware/efi/efivars
    chroot $destino /usr/sbin/grub2-install
    opensuse_secureboot=(chroot $destino /usr/sbin/shim-install --config-file=/boot/grub2/grub.cfg)
else
    echo -e "\nInstalando o GRUB em modo BIOS\n"
    comando_2="zypper -n --no-refresh --ignore-unknown --root $destino install -y --download-in-advance grub2-i386-pc-extras"
    tentar "$comando_1 ; $comando_2" $tentivas_maximas
    chroot $destino /usr/sbin/grub2-install $dispositivo_boot
fi

sed -i '/^GRUB_CMDLINE_LINUX_DEFAULT=/s/GRUB_CMDLINE_LINUX_DEFAULT=".*"/GRUB_CMDLINE_LINUX_DEFAULT="quiet splash security=apparmor loglevel=3 nosimplefb=1 kvm.enable_virt_at_load=0"/' $destino/etc/default/grub
sed -i 's/.*GRUB_TERMINAL.*/GRUB_TERMINAL=gfxterm/' $destino/etc/default/grub
sed -i 's/.*GRUB_GFXMODE.*/GRUB_GFXMODE=auto/' $destino/etc/default/grub
echo "GRUB_DISABLE_OS_PROBER=\"false\"" >> $destino/etc/default/grub

echo
chroot $destino /usr/bin/dracut -f --regenerate-all
echo
chroot $destino /usr/sbin/grub2-mkconfig -o /boot/grub2/grub.cfg
echo
"${opensuse_secureboot[@]}"
echo

### Ajustando o tema de inialização do sistema ###
chroot $destino /usr/sbin/plymouth-set-default-theme bgrt
chroot $destino /usr/bin/dracut -f --regenerate-all

### Instalando o SUSE Prime e ajustando para não desligar o áudio do HDMI ###
if [[ "$laptop" == [sS] ]]; then
    ### Instalando componentes para melhor experiência com laptops ###
    echo -e "\nInstalando componentes para melhor experiência com laptops\n"
    if [ "$num_gpus" -gt 1 ]; then
        switcheroo_control="switcheroo-control"
    fi
 
    comando_1="zypper -n --root $destino refresh -f -r \"repo-oss\""
    comando_2="zypper -n --no-refresh --ignore-unknown --root $destino install -y --download-in-advance -t pattern laptop"
    comando_3="zypper -n --no-refresh --ignore-unknown --root $destino install -y --download-in-advance touchegg $switcheroo_control"

    tentar "$comando_1 ; $comando_2 && $comando_3" $tentivas_maximas

    if [[ $instalar_nvidia == "Sim" ]]; then
        echo -e "\nInstalando o SUSE Prime e ajustando para não desligar o áudio do HDMI\n"
        comando_1="zypper -n --root $destino refresh -f -r \"repo-oss\""
        comando_2="zypper -n --no-refresh --ignore-unknown --root $destino install -y --download-in-advance suse-prime suseprime-appindicator"

        tentar "$comando_1 ; $comando_2" $tentivas_maximas

        echo '# Enable runtime PM for NVIDIA VGA/3D controller devices on driver bind
        ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="auto"
        ACTION=="bind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="auto"

        # Disable runtime PM for NVIDIA VGA/3D controller devices on driver unbind
        ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030000", TEST=="power/control", ATTR{power/control}="on"
        ACTION=="unbind", SUBSYSTEM=="pci", ATTR{vendor}=="0x10de", ATTR{class}=="0x030200", TEST=="power/control", ATTR{power/control}="on"' > $destino/etc/udev/rules.d/90-nvidia-udev-pm-G05.rules

        # Habilitar controle de energia dinâmico
        echo 'options nvidia NVreg_DynamicPowerManagement=0x02' > $destino/etc/modprobe.d/09-nvidia-dpm.conf

        # Habilitar o SUSE Prime e realizar as configurações necessárias
        chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/prime-select.service /etc/systemd/system/multi-user.target.wants/prime-select.service
        echo "offload" > $destino/etc/prime/boot
        echo "offload" > $destino/etc/prime/current_type
        echo "$iGPU" > $destino/etc/prime/offload_type
        echo "$usuario" > $destino/etc/prime/user
    fi

    # Habilitando o TouchEgg
    chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/touchegg.service /etc/systemd/system/multi-user.target.wants/touchegg.service

    # Habilitar o serviço do switcheroo-control
    if [ ! -z "$switcheroo_control" ]; then
        chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/switcheroo-control.service /etc/systemd/system/graphical.target.wants/switcheroo-control.service
    fi
fi

### Criando diretório images ###
mkdir $destino/usr/share/images

### Habilitando serviço de rede ###
echo -e "\nHabilitando serviço de rede\n"
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/NetworkManager.service /etc/systemd/system/network.service
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/NetworkManager.service /etc/systemd/system/multi-user.target.wants/NetworkManager.service
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/NetworkManager-dispatcher.service /etc/systemd/system/dbus-org.freedesktop.nm-dispatcher.service
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/NetworkManager-wait-online.service /etc/systemd/system/network-online.target.wants/NetworkManager-wait-online.service

### Habilitando Firewalld ###
echo -e "\nHabilitando Firewalld\n"
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/firewalld.service /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/firewalld.service /etc/systemd/system/multi-user.target.wants/firewalld.service

### Habilitando Chronyd ###
echo -e "\nHabilitando Chronyd\n"
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/chronyd.service /etc/systemd/system/multi-user.target.wants/chronyd.service

### Habilitando General Purpose Mouse ###
echo -e "\nHabilitando General Purpose Mouse\n"
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/gpm.service /etc/systemd/system/multi-user.target.wants/gpm.service

### Habilitando Libvirtd ###
echo -e "\nHabilitando Libvirtd\n"
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/libvirtd.service /etc/systemd/system/multi-user.target.wants/libvirtd.service
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/virtlockd.socket /etc/systemd/system/sockets.target.wants/virtlockd.socket
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/virtlogd.socket /etc/systemd/system/sockets.target.wants/virtlogd.socket
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/libvirtd.socket /etc/systemd/system/sockets.target.wants/libvirtd.socket
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/libvirtd-ro.socket /etc/systemd/system/sockets.target.wants/libvirtd-ro.socket

### Habilitando Earlyoom ###
echo -e "\nHabilitando Earlyoom\n"
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/earlyoom.service /etc/systemd/system/multi-user.target.wants/earlyoom.service

### Habilitando o TuneD ###
echo -e "\nHabilitando o TuneD\n"
chroot $destino /usr/bin/ln -s /usr/lib/systemd/system/tuned.service /etc/systemd/system/multi-user.target.wants/tuned.service

### Desabilitando a política de nomes de interface de rede ###
echo -e "\nDesabilitando a política de nomes de interface de rede\n"
chroot $destino /usr/bin/ln -s /dev/null /etc/systemd/network/99-default.link

### Garantindo o início do nm-applet quando o shell padrão não for o bash ###
cp $destino/usr/share/applications/nm-applet.desktop $destino/etc/xdg/autostart/nm-applet.desktop

### Desabilitando o início automático do applet do FirewallD ###
echo '[Desktop Entry]
Hidden=true' > $destino/etc/xdg/autostart/firewall-applet.desktop

### Desligando o beep do XFCE ###
echo '[Desktop Entry]
Type=Application
Encoding=UTF-8
Name=Bell off
Comment=Desliga o beep do XFCE
Exec=/usr/bin/xset b off
Icon=
Terminal=False' > $destino/etc/xdg/autostart/bell-off.desktop

### Permitindo conexões ao servidor X ###
echo '[Desktop Entry]
Type=Application
Encoding=UTF-8
Name=Distrobox Xhost Allower
Comment=Allows apps running in Distrobox containers to use the local X server.
Exec=bash -c "/usr/bin/xhost +si:localuser:$USER"
Terminal=False' > $destino/etc/xdg/autostart/distrobox-xhost-allower.desktop

### Ajustando o PolicyKit para respeitar o grupo wheel ###
echo "polkit.addAdminRule(function(action, subject) {
    return [\"unix-user:0\", \"unix-group:wheel\"];
});" > $destino/etc/polkit-1/rules.d/00-wheel.rules

chmod +r $destino/etc/polkit-1/rules.d/00-wheel.rules

### Ajustando o nome do computador ###
echo "$nome_computador" > $destino/etc/hostname

### Ajustando idioma e fuso ###
echo "LANG=pt_BR.utf8" > $destino/etc/environment
echo "QT_QPA_PLATFORMTHEME=qt5ct" >> $destino/etc/environment
sed 's/INSTALLED_LANGUAGES=""/INSTALLED_LANGUAGES="pt_BR"/' -i $destino/etc/sysconfig/language
sed 's/ROOT_USES_LANG="ctype"/ROOT_USES_LANG="yes"/' -i $destino/etc/sysconfig/language
echo "LANG=pt_BR.UTF-8" > $destino/etc/locale.conf
echo "LC_ALL=pt_BR.UTF-8" >> $destino/etc/locale.conf
rm $destino/etc/localtime
ln -s /usr/share/zoneinfo/America/Sao_Paulo $destino/etc/localtime

echo "Section \"InputClass\"
        Identifier \"system-keyboard\"
        MatchIsKeyboard \"on\"
        Option \"XkbLayout\" \"br\"
        Option \"XkbModel\" \"pc105+inet\"
        Option \"XkbOptions\" \"terminate:ctrl_alt_bksp\"
EndSection" > $destino/etc/X11/xorg.conf.d/00-keyboard.conf

echo "KEYMAP=br
FONT=ter-v22b
FONT_MAP=
FONT_UNIMAP=" > $destino/etc/vconsole.conf

### Ajustando o tema do gerenciador de login ###
echo "[greeter]
background = /usr/share/wallpapers/openSUSEdefault/contents/images/default-dark.png
user-background = false
theme-name = Adapta-LightGreen-Nokto
indicators = ~host;~spacer;~clock;~spacer;~language;~layout;~session;~a11y;~power;
font-name = Open Sans 16
icon-theme-name = breeze-dark
clock-format = %a, %T
screensaver-timeout = 2
xft-antialias = true" > $destino/etc/lightdm/lightdm-gtk-greeter.conf

### Habilitando cores para algumas aplicações de linha de comando ###
echo 'CLICOLOR=1' >> $destino/etc/environment

### Ajustando permissão para o LightDM funcionar ###
chroot $destino /usr/bin/chown -R lightdm: /var/lib/lightdm

### Adicionando repositório do Flathub ###
chroot $destino /usr/bin/flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

### Limpando pacotes já baixados ###
zypper -n --root $destino clean

### Removendo pacotes desnecessários ###
zypper -n --root $destino remove -y --clean-deps java-11-openjdk java-11-openjdk-headless javapackages-filesystem javapackages-tools busybox-ed hddtemp openssh-askpass xf86-input-keyboard postfix konsole konsole-part git-gui

### Garantindo que as bibliotecas gráficas vêm do Packman ###
echo -e "\nAtualizando pacotes\n"

comando_1="zypper -n --root $destino refresh -f -r \"Packman Repository\""
comando_2="zypper -n --no-refresh --root $destino dist-upgrade -y --download-in-advance --from \"Packman Repository\" --allow-vendor-change --replacefiles"
comando_3="zypper -n --no-refresh --root $destino dist-upgrade -y --download-in-advance --replacefiles"

tentar "$comando_1 ; $comando_2 && $comando_3" $tentivas_maximas

### Habilitando os reposótios Emulators e Multimedia Pro Audio ###
echo -e "\nHabilitando os repositórios Emulators e Multimedia Pro Audio\n"
zypper --root $destino modifyrepo --enable "Emulators"
zypper --root $destino modifyrepo --enable "Multimedia Proaudio"

zypper --root $destino --gpg-auto-import-keys refresh -f

### Ajustando o tempo de atualização automática dos repositórios para 7 dias ###
echo -e "\nAjustando o tempo de atualização automática dos repositórios para 7 dias\n"
sed -i '/# repo.refresh.delay = 10/a repo.refresh.delay = 10080' $destino/etc/zypp/zypp.conf

### Instalando o tema Adapta ###
echo -e "\nInstalando o tema Adpata\n"

mkdir -p $destino/usr/share/themes/Adapta
if [ -f "compactados/tema-adapta.tar.xz" ]; then
    tema_adpta_tar_xz="compactados/tema-adapta.tar.xz"
else
    comando_1="wget -q --show-progress https://github.com/jpmsb/preparando-computador-para-engenharia-de-tele/raw/main/compactados/tema-adapta.tar.xz -O /tmp/adapta.tar.xz"

    tentar "$comando_1" $tentivas_maximas

    tema_adpta_tar_xz="/tmp/adapta.tar.xz"
fi

tar -xf $tema_adpta_tar_xz -C $destino/usr/share/themes

### Instalando o tema Chameleon Breeze Dark ###
echo -e "\nInstalando o tema Chameleon Breeze Dark\n"

if [ -f "compactados/Chameleon-Breeze-Dark.tar.xz" ]; then
    tema_chameleon_breeze_dark_tar_xz="compactados/Chameleon-Breeze-Dark.tar.xz"
else
    comando_1="wget -q --show-progress https://github.com/jpmsb/preparando-computador-para-engenharia-de-tele/raw/main/compactados/Chameleon-Breeze-Dark.tar.xz -O /tmp/Chameleon-Breeze-Dark.tar.xz"

    tentar "$comando_1" $tentivas_maximas

    tema_chameleon_breeze_dark_tar_xz="/tmp/Chameleon-Breeze-Dark.tar.xz"
fi

tar -xf $tema_chameleon_breeze_dark_tar_xz -C $destino/usr/share/themes

### Instalando o tema Chameleon Breeze Darker ###
echo -e "\nInstalando o tema Chameleon Breeze Darker\n"
comando_1="wget -q --show-progress https://github.com/jpmsb/preparando-computador-para-engenharia-de-tele/raw/main/compactados/Chameleon-Breeze-Darker.tar.xz -O /tmp/Chameleon-Breeze-Darker.tar.xz"

tentar "$comando_1" $tentivas_maximas

tar -xf /tmp/Chameleon-Breeze-Darker.tar.xz -C $destino/usr/share/themes

### Criando tema de cores para o Qt5ct ###
echo '[ColorScheme]
active_colors=#ffffffff, #ff31363b, #ff979797, #ff5e5c5b, #ff9f9f9f, #ff4a4947, #ffffffff, #ffffffff, #ffffffff, #ff1b1e20, #ff2a2e32, #ffe7e4e0, #ff00a489, #fff9f9f9, #ff0986d3, #ffa70b06, #ff5c5b5a, #ffffffff, #ff3f3f36, #ffffffff, #80ffffff
disabled_colors=#ff808080, #ff31363b, #ff979797, #ff5e5c5b, #ff9f9f9f, #ff4a4947, #ff808080, #ffffffff, #ff808080, #ff1b1e20, #ff2a2e32, #ffe7e4e0, #ff13181e, #ff808080, #ff0986d3, #ffa70b06, #ff5c5b5a, #ffffffff, #ff3f3f36, #ffffffff, #80ffffff
inactive_colors=#ffffffff, #ff31363b, #ff979797, #ff5e5c5b, #ff9f9f9f, #ff4a4947, #ffffffff, #ffffffff, #ffffffff, #ff1b1e20, #ff2a2e32, #ffe7e4e0, #ff00a489, #fff9f9f9, #ff0986d3, #ffa70b06, #ff5c5b5a, #ffffffff, #ff3f3f36, #ffffffff, #80ffffff' > $destino/usr/share/qt5ct/colors/chameleon-dark.conf

echo '[ColorScheme]
active_colors=#ffffffff, #ff14191f, #ff979797, #ff5e5c5b, #ff9f9f9f, #ff4a4947, #ffffffff, #ffffffff, #ffffffff, #ff14191f, #ff14191f, #ffe7e4e0, #ff00a489, #fff9f9f9, #ff0986d3, #ffa70b06, #ff5c5b5a, #ffffffff, #ff3f3f36, #ffffffff, #80ffffff
disabled_colors=#ff808080, #ff14191f, #ff979797, #ff5e5c5b, #ff9f9f9f, #ff4a4947, #ff808080, #ffffffff, #ff808080, #ff14191f, #ff14191f, #ffe7e4e0, #ff13181e, #ff808080, #ff0986d3, #ffa70b06, #ff5c5b5a, #ffffffff, #ff3f3f36, #ffffffff, #80ffffff
inactive_colors=#ffffffff, #ff14191f, #ff979797, #ff5e5c5b, #ff9f9f9f, #ff4a4947, #ffffffff, #ffffffff, #ffffffff, #ff14191f, #ff14191f, #ffe7e4e0, #ff00a489, #fff9f9f9, #ff0986d3, #ffa70b06, #ff5c5b5a, #ffffffff, #ff3f3f36, #ffffffff, #80ffffff' > $destino/usr/share/qt5ct/colors/chameleon-darker.conf

### Criando esquema de cor Chameleon Breeze Dark ###
criar_esquema_chameleon_breeze_dark > $destino/usr/share/color-schemes/Chameleon-Breeze-Dark.colors

### Criando esquema de cor Chameleon Breeze Darker ###
criar_esquema_chameleon_breeze_darker > $destino/usr/share/color-schemes/Chameleon-Breeze-Darker.colors

### Criando o arquivo kdeglobals ###
criar_arquivo_kdeglobals > $destino/etc/xdg/kdeglobals

### Habilitando a tela de boas vindas ###
cp $destino/usr/share/applications/org.opensuse.opensuse_welcome.desktop $destino/etc/xdg/autostart/org.opensuse.opensuse_welcome.desktop

### Adicionando o /bin/fish ao arquivo /etc/shells ###
echo "/bin/fish" >> $destino/etc/shells

### Instalando a fonte Noto Mono Nerd Font ###
echo -e "\nInstalando a fonte Noto Mono Nerd Font\n"
comando_1="wget -q --show-progress https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/Noto/Mono/NotoMonoNerdFontMono-Regular.ttf -O $destino/usr/share/fonts/NotoMonoNerdFontMono-Regular.ttf"

tentar "$comando_1" $tentivas_maximas

chroot $destino /usr/bin/fc-cache -r

### Instalando um skel ###
echo -e "\nInstalando um skel\n"
comando_1="wget -q --show-progress https://github.com/jpmsb/preparando-computador-para-engenharia-de-tele/raw/main/compactados/skel.tar.xz -O /tmp/skel.tar.xz"

tentar "$comando_1" $tentivas_maximas

tar -xf /tmp/skel.tar.xz -C $destino/etc/skel

### Correção do tema de cores do nomacs - Image Lounge ###
mkdir -p $destino/etc/skel/.config/nomacs
echo '[DisplaySettings]
bgColorNoMacsRGBA=4281545523
bgColorWidgetRGBA=2852126720
fontColorRGBA=4292730333
highlightColorRGBA=4278233855
iconColorRGBA=4292730333
themeName312=Dark-Theme.css
tpPattern=true' > "$destino/etc/skel/.config/nomacs/Image Lounge.conf"

### Tema de cores Breeze Dark para o Okular ###
echo '[UiSettings]
ColorScheme=Chameleon Breeze Darker' > $destino/etc/skel/.config/okularrc

### Definindo configurações para o xfce4-terminal ###
echo '<?xml version="1.0" encoding="UTF-8"?>

<channel name="xfce4-terminal" version="1.0">
  <property name="color-palette" type="string" value="rgb(0,0,0);rgb(170,0,0);rgb(0,170,0);rgb(246,211,45);rgb(62,125,205);rgb(170,0,170);rgb(0,170,170);rgb(170,170,170);rgb(85,85,85);rgb(255,85,85);rgb(85,255,85);rgb(255,255,85);rgb(85,85,255);rgb(255,85,255);rgb(85,255,255);rgb(255,255,255)"/>
  <property name="font-name" type="string" value="NotoMono Nerd Font Mono 12"/>
  <property name="scrolling-unlimited" type="bool" value="true"/>
  <property name="run-custom-command" type="bool" value="true"/>
  <property name="custom-command" type="string" value="/usr/bin/fish"/>
</channel>' > $destino/etc/xdg/xfce4/xfconf/xfce-perchannel-xml/xfce4-terminal.xml

### Instalando o pacote de ícones Tela (modo standard) ###
echo -e "\nInstalando o tema de ícones Tela\n"
ultima_tag_tela=$(basename $(curl -Ls -o /dev/null -w %{url_effective} https://github.com/vinceliuice/Tela-icon-theme/releases/latest))
comando_1="wget -q --show-progress https://github.com/vinceliuice/Tela-icon-theme/archive/refs/tags/$ultima_tag_tela.tar.gz -O /tmp/Tela-icon-theme.tar.gz"

tentar "$comando_1" $tentivas_maximas

tar -xf /tmp/Tela-icon-theme.tar.gz -C /tmp
bash /tmp/Tela-icon-theme-$ultima_tag_tela/install.sh -d $destino/usr/share/icons > /dev/null

ajustar_tema_icones_tela $destino/usr/share/icons

### Ajustando o Package Update Indicator para ###
### utilizar um script customizado            ###
mkdir -p $destino/etc/skel/.config/package-update-indicator/
echo "[General]
refresh-interval=43200
update-command='/usr/local/bin/atualizar-sistema'" > $destino/etc/skel/.config/package-update-indicator/package-update-indicator.conf

### Ajustando para que o Package Update Indicator ###
### seja exibido no Gnome e KDE                   ###
sed -i '${/^NotShowIn/s/^/# /}' $destino/etc/xdg/autostart/org.guido-berhoerster.code.package-update-indicator.desktop

### Script para atualizar o sistema ###
echo -e "\nInstalando o script para atualizar o sistema\n"
comando_1="wget -q --show-progress https://raw.githubusercontent.com/jpmsb/preparando-computador-para-engenharia-de-tele/main/scripts-auxiliares/atualizar-sistema -O $destino/usr/local/bin/atualizar-sistema"

tentar "$comando_1" $tentivas_maximas

chmod +x $destino/usr/local/bin/atualizar-sistema

### Criando usuário com poder sudo ###
echo -e "\nCriando usuário \"$usuario\" com poder sudo\n"
useradd --root $destino -m --groups libvirt,kvm,wheel,users,video,dialout -c "$nome_completo" --shell /bin/bash $usuario
echo "$usuario:$senha" | chpasswd --root $destino
rm -rf $destino/home/$usuario/bin

### Adicionando caminhos extras de binários no FISH ###
echo 'for i in /bin /sbin /usr/local/sbin /usr/local/bin
    if not contains $i $PATH
        set PATH $PATH $i
    end 
end

if not contains $HOME/.local/bin $PATH
    set PATH $HOME/.local/bin $PATH
end' > $destino/etc/fish/conf.d/extra_paths.fish

### Adicionando caminhos extras de binários no BASH ###
echo 'new_paths=("/bin" "/sbin" "/usr/local/sbin" "/usr/local/bin")

for new_path in "${new_paths[@]}"
do  
    if [[ ":$PATH:" != *":$new_path:"* ]]; then
        export PATH="$PATH:$new_path"
    fi
done

if [[ ":$PATH:" != *":$HOME/.local/bin:"* ]]; then
    export PATH="$HOME/.local/bin:$PATH"
fi' > $destino/etc/profile.d/extra_paths.sh

### Definindo o interpretador de comandos FISH na variável SHELL ###
echo 'export SHELL=/usr/bin/fish' > $destino/etc/profile.d/default_shell.sh
echo 'SHELL=/usr/bin/fish' >> $destino/etc/environment

### Definindo as variáveis de ambiente para habilitar o download paralelo do Zypper ###
echo 'set --export ZYPP_CURL2 1
set --export ZYPP_PCK_PRELOAD 1
set --export ZYPP_MEDIANETWORK 1' > $destino/etc/fish/conf.d/zypper_parallel_download.fish

echo 'export ZYPP_CURL2=1
export ZYPP_PCK_PRELOAD=1
export ZYPP_MEDIANETWORK=1' > $destino/etc/profile.d/zypper_parallel_download.sh

### Ajuste no sudo para preservar as variáveis de ambiente ###
### que habilitam o download paralelo do Zypper            ###
echo 'Defaults env_keep += "ZYPP_CURL2 ZYPP_PCK_PRELOAD ZYPP_MEDIANETWORK"' > $destino/etc/sudoers.d/zypper_parallel_download
chmod 440 $destino/etc/sudoers.d/zypper_parallel_download

### Ajuste no sudo para preservar as variáveis de ambiente ###
### que permitem a execução de aplicações gráficas com     ###
### usuário privilegiado                                   ###
echo 'Defaults env_keep += "DISPLAY XAUTHORITY"' > $destino/etc/sudoers.d/graphical_envs
chmod 440 $destino/etc/sudoers.d/graphical_envs

### Criando o cache do tealdeer ###
chroot $destino /usr/bin/su -c "/usr/bin/tldr --update" -s /bin/bash $usuario

### Ajustando o tema dos aplicativos do Gnome ###
echo "[org.gnome.desktop.interface]
color-scheme='prefer-dark'" > $destino/usr/share/glib-2.0/schemas/10_org.gnome.desktop.interface.gschema.override
chroot $destino /usr/bin/glib-compile-schemas /usr/share/glib-2.0/schemas

### Loja Gnome Software deve preferir o repositório local ao invés de Flatpak ###
echo "[org.gnome.software]
packaging-format-preference = [ 'package', 'flatpak' ]" > $destino/usr/share/glib-2.0/schemas/20_org.gnome.software-jpmsb.gschema.override
chroot $destino /usr/bin/glib-compile-schemas /usr/share/glib-2.0/schemas

### Definindo a senha do root ###
echo -e "\nDefinindo a senha do usuário root\n"
echo "root:$senha_root" | chpasswd --root $destino

### Ajustando as permissões dos diretórios do PolicyKit ###
chroot $destino /usr/bin/chown -R root:root /usr/share/polkit-1/
chroot $destino /usr/bin/chown polkitd:root /usr/share/polkit-1/rules.d
chroot $destino /usr/bin/chown polkitd:root /usr/share/polkit-1/rules.d/50-default.rules
chroot $destino /usr/bin/chown polkitd:root /etc/polkit-1/rules.d

### Ajustando a zona padrão do Firewalld para 'trusted' ###
chroot $destino /usr/bin/firewall-offline-cmd --set-default-zone=trusted

### Desmontando diretórios ###
desmontar_tudo $destino

echo -e "${verde}\n\nTudo pronto!! Digite \"sudo reboot\" para reiniciar o seu computador.${normal}"
